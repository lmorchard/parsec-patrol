(function(){var e=[].slice,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};define(["utils","entities","components","systems","underscore","pubsub","Stats","QuadTree"],function(t,r,i,s,o,u,a,f){var l,c,h,p,d;return d=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return setTimeout(e,1e3/60)},h=60,c=1e3/h,p=function(){function n(){var n,i,s;s=arguments[0],n=arguments[1],i=3<=arguments.length?e.call(arguments,2):[],this.width=s!=null?s:640,this.height=n!=null?n:480,this.id=t.generateID(),this.is_running=!1,this.is_paused=!1,this.inputs={},this.entities=new r.EntityManager(this.width,this.height),this.systems=[],this.msg_subscribers={},this.addSystem.apply(this,i)}return n.prototype.measure_fps=!1,n.prototype.tick_duration=c,n.prototype.max_t_delta=c*5,n.prototype._psPrefix=function(e){return e==null&&(e=null),e=e?"."+e:"","worlds."+this.id+e},n.prototype.subscribe=function(e,t){var n;return((n=this.msg_subscribers)[e]!=null?(n=this.msg_subscribers)[e]:n[e]=[]).push(t)},n.prototype.publish=function(){var t,n,r,i,s,o,u;r=arguments[0],t=2<=arguments.length?e.call(arguments,1):[];if(!this.msg_subscribers[r])return;o=this.msg_subscribers[r],u=[];for(i=0,s=o.length;i<s;i++)n=o[i],u.push(n.apply(null,[r].concat(e.call(t))));return u},n.prototype.unsubscribe=function(e){},n.prototype.addSystem=function(){var t,n,r,i;n=1<=arguments.length?e.call(arguments,0):[];for(r=0,i=n.length;r<i;r++)t=n[r],t.setWorld(this),this.systems.push(t);return this},n.prototype.removeSystem=function(e){return e.world=null,this.systems.splice(this.systems.indexOf(e),1),this},n.prototype.tick=function(e){var t,n,r,i;this.entities.update(e),i=this.systems;for(n=0,r=i.length;n<r;n++)t=i[n],t.update(e);return this},n.prototype.draw=function(e){var t,n,r,i;i=this.systems;for(n=0,r=i.length;n<r;n++)t=i[n],t.draw(e);return this},n.prototype.load=function(e){return this.entities.load(e),this.current_scene=e.current_scene,this},n.prototype.save=function(e){return e=this.entities.save(),e.current_scene=this.current_scene,e},n.prototype.start=function(){var e,t,n=this;if(this.is_running)return;return this.is_running=!0,this.t_draw_last=0,this.t_game_last=0,this.accumulator=0,this.tick_duration_sec=this.tick_duration/1e3,this.measure_fps&&(this.stats=new a,this.stats.setMode(0),document.body.appendChild(this.stats.domElement)),e=function(t){var r;n.measure_fps&&n.stats.begin(),r=Math.min(t-n.t_draw_last,n.max_t_delta),n.t_draw_last=t,n.draw(r),n.measure_fps&&n.stats.end();if(n.is_running)return d(e)},d(e),this.t_game_last=Date.now(),t=function(){var e;e=Math.min(Date.now()-n.t_game_last,n.max_t_delta),n.t_game_last=Date.now();if(!n.is_paused){n.accumulator+=e;while(n.accumulator>n.tick_duration)n.tick(n.tick_duration_sec),n.accumulator-=n.tick_duration}if(n.is_running)return setTimeout(t,n.tick_duration)},setTimeout(t,this.tick_duration),this},n.prototype.stop=function(){return this.is_running=!1,this},n.prototype.pause=function(){return this.is_paused=!0,this},n.prototype.unpause=function(){return this.is_paused=!1,this},n}(),l=function(e){function t(){t.__super__.constructor.apply(this,arguments)}return n(t,e),t}(p),{World:p,BasicWorld:l}})}).call(this);