(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define("app",["worlds","entities","components","systems","pubsub","jquery","underscore","Vector2D","utils"],function(e,n,r,i,s,o,u,a,f){var l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M=this;l=30,c=function(e){function n(){return A=n.__super__.constructor.apply(this,arguments),A}return t(n,e),n}(r.Component),h=function(e){function n(){return O=n.__super__.constructor.apply(this,arguments),O}return t(n,e),n.prototype.match_component=c,n.prototype.update_match=function(e,t,n){var i;return i=this.world.entities.get(t,r.Position),i.x=this.world.inputs.pointer_world_x,i.y=this.world.inputs.pointer_world_y},n}(i.System),v=document.getElementById("gameCanvas"),p=document.getElementById("gameArea"),k=new e.World(3e3,3e3,C=new i.ViewportSystem(window,p,v,1,1,3),new i.RadarSystem(v,.28),new i.PointerInputSystem(v),new h,new i.ClickCourseSystem,new i.SpawnSystem,new i.SpinSystem,new i.OrbiterSystem,new i.SeekerSystem,new i.ThrusterSystem,new i.HealthSystem,new i.BeamWeaponSystem,new i.ExplosionSystem),k.measure_fps=!0,window.world=k,window.vp=C,b=k.entities,k.current_scene=S=b.createGroup(g=b.create(new r.TypeName("Star"),new r.EntityName("sun"),new r.Spawn("center"),new r.Position,new r.Sprite("star"),new r.RadarPing("#ff3")),m=b.create(new r.TypeName("HeroShip"),new r.EntityName("hero"),new r.Sprite("hero"),new r.Position,new r.Collidable,new r.Spawn("at",-45,45),new r.Seeker(null,Math.PI),new r.Thruster(150,75,0,0,!1),new r.ClickCourse(T=!0),new r.Health(2e4),new r.WeaponsTarget("commonwealth"),d=new r.BeamWeapon(15,4,600,4500,4500,4500,"#33f","invaders"),new r.RadarPing("#3f3"),new r.Tombstone(new r.TypeName("Explosion"),new r.Position,new r.Explosion(5,100,50,1.5,250,"#fff")))),C.follow_entity=m,N=new a(0,0),w=0,o("#beam_sel").click(function(e){var t;return t=o(e.target),d.active_beams=t.attr("value"),!1}),x=function(){var e;return w++,e=new a(0,-1500*Math.random()),e.rotateAround(N,Math.PI*2*Math.random()),b.addToGroup(S,b.create(new r.TypeName("EnemyScout"),new r.EntityName("enemy-"+w),new r.Sprite("enemyscout","#f33",12,12),new r.Spawn("at",e.x,e.y),new r.Position,new r.Collidable,new r.Thruster(100,50,0,0),new r.Seeker(m,Math.PI*2),new r.Health(300),new r.WeaponsTarget("invaders"),new r.BeamWeapon(1,1,100,250,250,500,"#f44","commonwealth"),new r.RadarPing("#f33"),new r.Tombstone(new r.TypeName("Explosion"),new r.Position,new r.Explosion(.5,40,25,1.5,175,"#f33"))))},k.subscribe(i.SpawnSystem.MSG_DESPAWN,function(e,t){var n,i,s,o,u;u=b.get(t.entity_id,r.TypeName),(u!=null?u.name:void 0)==="EnemyScout"&&(s=function(){var e,t;e=b.getComponents(r.TypeName),t=[];for(n in e)o=e[n],o.name==="EnemyScout"&&t.push(n);return t}(),s.length<=l&&x());if((u!=null?u.name:void 0)==="HeroShip")return i=function(){return location.reload()},setTimeout(i,5e3)});if(l)for(E=L=1;1<=l?L<=l:L>=l;E=1<=l?++L:--L)x();return function(){return k.start()}})}).call(this);