(function(){define(["worlds","entities","components","systems","pubsub","jquery","underscore","Vector2D","utils"],function(e,t,n,r,i,s,o,u,a){var f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T=this;l=!1,f=100,c=!1,d=document.getElementById("gameCanvas"),h=document.getElementById("gameArea"),S=new e.World(3e3,3e3,E=new r.ViewportSystem(window,h,d,1,1,5),new r.RadarSystem(d,.28),new r.PointerInputSystem(d),new r.ClickCourseSystem,new r.SpawnSystem,new r.SpinSystem,new r.OrbiterSystem,new r.SeekerSystem,new r.ThrusterSystem,new r.HealthSystem,new r.BeamWeaponSystem,new r.ExplosionSystem),S.measure_fps=!0,window.C=n,window.E=t,window.W=e,window.world=S,window.vp=E,m=S.entities,S.load(v={entities:{sun:{Sprite:{shape:"star"},Spawn:{position_logic:"center"},RadarPing:{color:"#ff0"},Position:{}},hero:{TypeName:{name:"HeroShip"},Sprite:{shape:"hero"},Position:{},Collidable:{},Spawn:{x:-65,y:65},Thruster:{dv:250,max_v:100,active:!1},Seeker:{rad_per_sec:Math.PI},ClickCourse:{stop_on_arrival:!0},Health:{max:"20000"},RadarPing:{color:"#0f0"},WeaponsTarget:{team:"commonwealth"},BeamWeapon:{max_beams:15,active_beams:9,max_range:1250,max_power:4500,charge_rate:4500,discharge_rate:4500,color:"#33f",target_team:"invaders"},Tombstone:{load:{Position:{},Explosion:{ttl:5,radius:70,max_particles:50,max_particle_size:1.5,max_velocity:300,color:"#fff"}}}}},groups:{main:["sun","hero"]}}),p=S.entities.get("hero",n.BeamWeapon),S.current_scene=y=o.keys(v.groups)[0],E.follow_entity="hero",s("#beam_sel").click(function(e){var t;return t=s(e.target),p.active_beams=t.attr("value"),!1}),w=new u(0,0),b=function(){var e,t,n;return n=new u(0,-1500*Math.random()),n.rotateAround(w,Math.PI*2*Math.random()),e=m.loadComponents({TypeName:{name:"EnemyScout"},Sprite:{shape:"enemyscout",stroke_style:"#f33",width:12,height:12},Spawn:{x:n.x,y:n.y},Position:{},Collidable:{},Thruster:{dv:100,max_v:50},Seeker:{target:"hero",rad_per_sec:Math.PI},Health:{max:"300"},WeaponsTarget:{team:"invaders"},RadarPing:{color:"#f00"},BeamWeapon:{max_beams:1,active_beams:1,max_range:75,max_power:250,charge_rate:250,discharge_rate:500,color:"#f44",target_team:"commonwealth"},Tombstone:{load:{Position:{},Explosion:{ttl:.5,radius:40,max_particles:25,max_particle_size:1.25,max_velocity:250,color:"#f33"}}}}),t=m.create.apply(m,e),m.addToGroup(y,t)},S.subscribe(r.SpawnSystem.MSG_DESPAWN,function(e,t){var r,i,o,u,a;a=m.get(t.entity_id,n.TypeName),(a!=null?a.name:void 0)==="EnemyScout"&&(o=function(){var e,t;e=m.getComponents(n.TypeName),t=[];for(r in e)u=e[r],u.name==="EnemyScout"&&t.push(r);return t}(),c&&o.length<=f&&b(),s("#out").val("ENEMIES: "+o.length+" "+o),o.length===1&&(i=function(){return location.reload()},setTimeout(i,5e3)));if((a!=null?a.name:void 0)==="HeroShip")return i=function(){return location.reload()},setTimeout(i,5e3)});if(f)for(g=x=1;1<=f?x<=f:x>=f;g=1<=f?++x:--x)b();return function(){return S.start()}})}).call(this);