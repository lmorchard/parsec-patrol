(function(){define(["worlds","entities","components","systems","pubsub","jquery","underscore","Vector2D","utils","dat"],function(e,t,n,r,i,s,o,u,a,f){var l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k=this;y={max_enemies:100,respawn_enemies:!0},p=document.getElementById("gameCanvas"),l=document.getElementById("gameArea"),T=new e.World(3e3,3e3,x=new r.ViewportSystem(window,l,p,1,1,5),new r.RadarSystem(p,.28),new r.PointerInputSystem(p),new r.ClickCourseSystem,new r.SpawnSystem,new r.SpinSystem,new r.OrbiterSystem,new r.SeekerSystem,new r.ThrusterSystem,new r.HealthSystem,new r.BeamWeaponSystem,new r.ExplosionSystem),T.measure_fps=!0,window.C=n,window.E=t,window.W=e,window.world=T,window.vp=x,v=T.entities,T.load(d={entities:{sun:{Sprite:{shape:"star"},Spawn:{position_logic:"center"},RadarPing:{color:"#ff0"},Position:{}},hero:{TypeName:{name:"HeroShip"},Sprite:{shape:"hero"},Position:{},Collidable:{},Spawn:{x:-65,y:65},Thruster:{dv:250,max_v:100,active:!1},Seeker:{rad_per_sec:Math.PI},ClickCourse:{stop_on_arrival:!0},Health:{max:"20000"},RadarPing:{color:"#0f0"},WeaponsTarget:{team:"commonwealth"},BeamWeapon:{max_beams:15,active_beams:9,max_range:1250,max_power:4500,charge_rate:4500,discharge_rate:4500,color:"#33f",target_team:"invaders"},Tombstone:{load:{Position:{},Explosion:{ttl:5,radius:70,max_particles:50,max_particle_size:1.5,max_velocity:300,color:"#fff"}}}}},groups:{main:["sun","hero"]}}),c=T.entities.get("hero",n.BeamWeapon),h=T.entities.get("hero",n.Health),T.current_scene=b=o.keys(d.groups)[0],x.follow_entity="hero",S=new u(0,0),w=function(){var e,t,n;return n=new u(0,-1500*Math.random()),n.rotateAround(S,Math.PI*2*Math.random()),e=v.loadComponents({TypeName:{name:"EnemyScout"},Sprite:{shape:"enemyscout",stroke_style:"#f33",width:12,height:12},Spawn:{x:n.x,y:n.y},Position:{},Collidable:{},Thruster:{dv:100,max_v:50},Seeker:{target:"hero",rad_per_sec:Math.PI},Health:{max:"300"},WeaponsTarget:{team:"invaders"},RadarPing:{color:"#f00"},BeamWeapon:{max_beams:1,active_beams:1,max_range:75,max_power:250,charge_rate:250,discharge_rate:500,color:"#f44",target_team:"commonwealth"},Tombstone:{load:{Position:{},Explosion:{ttl:.5,radius:40,max_particles:25,max_particle_size:1.25,max_velocity:250,color:"#f33"}}}}),t=v.create.apply(v,e),v.addToGroup(b,t)},E={enemy_ct:0},T.subscribe(r.SpawnSystem.MSG_DESPAWN,function(e,t){var r,i,s,o,u;u=v.get(t.entity_id,n.TypeName),s=function(){var e,t;e=v.getComponents(n.TypeName),t=[];for(r in e)o=e[r],o.name==="EnemyScout"&&t.push(r);return t}(),E.enemy_ct=s.length,(u!=null?u.name:void 0)==="EnemyScout"&&(y.respawn_enemies&&s.length<=y.max_enemies&&w(),s.length===1&&(i=function(){return location.reload()},setTimeout(i,5e3)));if((u!=null?u.name:void 0)==="HeroShip")return i=function(){return location.reload()},setTimeout(i,5e3)});if(y.max_enemies)for(g=N=1,C=y.max_enemies;1<=C?N<=C:N>=C;g=1<=C?++N:--N)w();return m=new f.GUI,m.add(x,"zoom",1,15).step(.25),m.add(c,"active_beams",1,15).step(1),m.add(y,"max_enemies",1,200).step(10),m.add(y,"respawn_enemies"),m.add(E,"enemy_ct").listen(),function(){return T.start()}})}).call(this);