(function(){define(["worlds","entities","components","systems","utils","pubsub","jquery","underscore","dat","Vector2D"],function(e,t,n,r,i,s,o,u,a,f){return function(t,n,s){var o,l,c,h,p,d,v,m,g,y,b,w,E,x,T,N,C,k;return n==null&&(n=!0),s==null&&(s=!0),C=new e.World(1200,1200,N=new r.ViewportSystem(t),new r.PointerInputSystem(t),new r.ClickCourseSystem,new r.SpawnSystem,new r.HealthSystem,o=new r.CollisionSystem(c=!1,p=!1),new r.BouncerSystem,new r.SeekerSystem,y=new r.PotentialSteeringSystem(h=!0),T=new r.SteeringSystem(d=!0),new r.ThrusterSystem,new r.MotionSystem,new r.SpinSystem,new r.VaporTrailSystem,new r.BeamWeaponSystem,new r.ExplosionSystem),m=C.entities,C.load({entities:{hero:{TypeName:{name:"HeroShip"},Sprite:{shape:"hero",width:75,height:75,stroke_style:"#3f3"},Spawn:{x:450,y:0,rotation:Math.PI*-0.5},Position:{},Motion:{dx:0,dy:0},Collidable:{},CollisionCircle:{radius:37.5}}},groups:{main:["rock","hero"]},current_scene:"main"}),w=function(){var e,t,n,r,i,s,o,u,a,f,l;if(C.is_paused)return;n=[[-450,-250,Math.PI*-0.75],[-450,-150,Math.PI*-0.5],[-450,0,0],[-450,150,Math.PI*.5],[-450,250,Math.PI*.75]],l=[];for(o=0,u=n.length;o<u;o++)a=n[o],i=a[0],s=a[1],r=a[2],e=C.entities.loadComponents({Sprite:{shape:"enemyscout",width:30,height:30,stroke_style:"#f33"},Spawn:{x:i,y:s,rotation:r,ttl:15},Position:{},Motion:{},Collidable:{},CollisionCircle:{radius:15},Bouncer:{mass:1e3,damage:0},Thruster:{dv:250,max_v:120},PotentialSteering:{target:"hero",sensor_range:140,rad_per_sec:Math.PI*1.5,attract_magnitude:8e3,attract_attenuation:1,repel_magnitude:9500,repel_attenuation:1.8},Tombstone:{load:{Position:{},Explosion:{ttl:.5,radius:40,max_particles:25,max_particle_size:1.25,max_velocity:250,color:"#f33"}}}}),t=(f=C.entities).create.apply(f,e),l.push(C.entities.addToGroup("main",t));return l},setInterval(w,15e3),w(),b=function(e,t,n,r,i,s,o,u,a){var f,l,c;return f=C.entities.loadComponents({Sprite:{shape:"asteroid",width:n,height:r},Spawn:{x:e,y:t,ttl:60*Math.random()},Motion:{dx:i,dy:s,drotation:o},Health:{max:a,show_bar:!1},Bouncer:{mass:u,damage:7e-4},RadarPing:{color:"#333"},Collidable:{},CollisionCircle:{radius:n/2*.85},Position:{},Tombstone:{load:{Position:{},Explosion:{ttl:.5,radius:40,max_particles:25,max_particle_size:1.25,max_velocity:250,color:"#fff"}}}}),l=(c=C.entities).create.apply(c,f),C.entities.addToGroup("main",l),l},E=function(e,t,n,r,s,o,a,l){var c,h,p,d,v,m,g,y,w,E,S,x,T,N,C,k;e==null&&(e=0),t==null&&(t=0),n==null&&(n=300),r==null&&(r=50),s==null&&(s=5),o==null&&(o=12),a==null&&(a=120),l==null&&(l=8),w=new f(e,t),S=new f(0,0),E=new f(0,0),v=[],k=[];for(d=C=1;1<=r?C<=r:C>=r;d=1<=r?++C:--C)k.push(function(){var e,t,r,f,d;d=[];for(c=e=1;1<=s?e<=s:e>=s;c=1<=s?++e:--e){y=u.random(o,a),S.setValues(w.x,w.y-u.random(1,n)),g=Math.PI*4*Math.random(),S.rotateAround(w,g),m=!0;for(t=0,r=v.length;t<r;t++){f=v[t],T=f[0],N=f[1],x=f[2],p=f[3];if(i.inCollision(T,N,x,p,S.x,S.y,y*1.0125,y*1.0125)){m=!1;break}}if(!m)continue;v.push([S.x,S.y,y,y]),E.setValues(0,Math.random()*l),E.rotate(g),d.push(h=b(S.x,S.y,y,y,E.x,E.y,Math.PI*.25*Math.random(),4*y*y,4*y*y))}return d}());return k},x=function(){if(C.is_paused)return;return E(-225,-225,100),E(-225,225,100),E(0,0,100),E(225,-225,100),E(225,225,100)},x(),setInterval(x,3e4),N.zoom=.85,N.draw_bounding_boxes=!0,N.draw_steering=!0,C.measure_fps=s,window.entities=C.entities,n&&(g=new a.GUI,g.add(C,"is_paused").listen(),g.add(N,"zoom",.125,3).step(.125),g.add(T,"debug_steering").listen(),g.add(o,"debug_bounding_boxes").listen(),g.add(o,"debug_quadtrees").listen(),g.add(y,"debug_potential_steering").listen()),window.world=C,C}})}).call(this);