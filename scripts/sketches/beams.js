(function(){define("sketches/beams",["worlds","entities","components","systems","pubsub","jquery","underscore","Vector2D","utils"],function(e,t,n,r,i,s,o,u,a){var f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N=this;l=!1,f=24,p=document.getElementById("gameCanvas"),c=document.getElementById("gameArea"),x=new e.World(640,480,new r.ViewportSystem(window,c,p,1,1),new r.PointerInputSystem(p),new r.ClickCourseSystem,new r.SpawnSystem,new r.OrbiterSystem,new r.SeekerSystem,new r.ThrusterSystem,new r.HealthSystem,new r.BeamWeaponSystem,new r.ExplosionSystem),x.measure_fps=!0,window.C=n,window.E=t,window.W=e,window.world=x,m=x.entities,x.load(v={entities:{sun:{Sprite:{shape:"star"},Spawn:{position_logic:"center"},Position:{}},hero:{TypeName:{name:"HeroShip"},Sprite:{shape:"hero"},Position:{},Collidable:{},Spawn:{x:-65,y:65},Orbit:{orbited_id:"sun",rad_per_sec:Math.PI/4},Health:{max:"20000"},WeaponsTarget:{team:"commonwealth"},BeamWeapon:{max_beams:15,active_beams:9,max_range:1250,max_power:4500,charge_rate:4500,discharge_rate:4500,color:"#33f",target_team:"invaders"},Tombstone:{load:{Position:{},Explosion:{ttl:5,radius:70,max_particles:50,max_particle_size:1.5,max_velocity:300,color:"#fff"}}}}},groups:{main:["sun","hero"]}}),h=x.entities.get("hero",n.BeamWeapon),x.current_scene=b=o.keys(v.groups)[0],S=new u(0,-300),E=new u(0,0),g=0,s("#beam_sel").click(function(e){var t;return t=s(e.target),h.active_beams=t.attr("value"),!1}),w=function(){var e,t;return g++,S.rotateAround(E,Math.PI*2*Math.random()),e=m.loadComponents({TypeName:{name:"EnemyScout"},Sprite:{shape:"enemyscout",stroke_style:"#f33",width:12,height:12},Spawn:{x:S.x,y:S.y},Position:{},Collidable:{},Thruster:{dv:100,max_v:50},Seeker:{target:"hero",rad_per_sec:Math.PI},Health:{max:"300"},WeaponsTarget:{team:"invaders"},BeamWeapon:{max_beams:1,active_beams:1,max_range:75,max_power:250,charge_rate:250,discharge_rate:500,color:"#f44",target_team:"commonwealth"},Tombstone:{load:{Position:{},Explosion:{ttl:.5,radius:40,max_particles:25,max_particle_size:1.25,max_velocity:250,color:"#f33"}}}}),t=m.create.apply(m,e),m.addToGroup(b,t)},x.subscribe(r.SpawnSystem.MSG_DESPAWN,function(e,t){var r,i,s,o,u;u=m.get(t.entity_id,n.TypeName),(u!=null?u.name:void 0)==="EnemyScout"&&(s=function(){var e,t;e=m.getComponents(n.TypeName),t=[];for(r in e)o=e[r],o.name==="EnemyScout"&&t.push(r);return t}(),s.length<=f&&w());if((u!=null?u.name:void 0)==="HeroShip")return i=function(){return location.reload()},setTimeout(i,5e3)});if(f)for(y=T=1;1<=f?T<=f:T>=f;y=1<=f?++T:--T)w();return l&&(d=[],x.subscribe(r.HealthSystem.MSG_DAMAGE,function(e,t){var r,i,o,u,f,l,c,h,p,v,g;p=m.get(t.from,n.TypeName);if((p!=null?p.name:void 0)!=="HeroShip")return;f=m.get(t.to,n.Health);if(!f)return;c=a.now(),d.push([c,t.amount]);while(c-d[0][0]>3e4)d.shift();h=d[0][0],l=d[d.length-1][0],o=l-h,r=0;for(v=0,g=d.length;v<g;v++)u=d[v],r+=u[1];return i=r/(o/1e3),s("#dps").attr("value",""+i)})),x.start()})}).call(this);