(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},n=[].slice;define(["components","utils","jquery","underscore","pubsub","Vector2D","Hammer"],function(e,r,i,s,o,u,a,f){var l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O;return x=function(){function e(){}return e.prototype.world=null,e.prototype.match_component=null,e.prototype.setWorld=function(e){return this.world=e},e.prototype.getMatches=function(){return this.match_component?this.world.entities.getComponents(this.match_component):[]},e.prototype.update=function(e){var t,n,r,i;r=this.getMatches(),i=[];for(n in r)t=r[n],i.push(this.update_match(e,n,t));return i},e.prototype.update_match=function(e,t,n){},e.prototype.draw=function(e){},e}(),m=function(e){function n(e){this.canvas=e}return t(n,e),n.prototype.setWorld=function(e){return n.__super__.setWorld.call(this,e),this.world.inputs.keyboard={}},n.prototype.update=function(e){},n}(x),y=function(e){function n(e){this.canvas=e}return t(n,e),n.prototype.setWorld=function(e){var t,s,o,u=this;return n.__super__.setWorld.call(this,e),s=["left","middle","right"],t=function(e){return function(t){var n;return n="pointer_button_"+s[t.button],u.world.inputs[n]=e?r.now():null,!1}},o=function(e){return function(t){var n;return n="pointer_button_"+s[0],u.world.inputs[n]=e?r.now():null,u.world.inputs.pointer_x=t.gesture.center.pageX-u.canvas.offsetLeft,u.world.inputs.pointer_y=t.gesture.center.pageY-u.canvas.offsetTop,!1}},i(this.canvas).bind("contextmenu",function(e){return!1}).bind("mousedown",t(!0)).bind("mouseup",t(!1)).bind("mousemove",function(e){return u.world.inputs.pointer_x=e.pageX-u.canvas.offsetLeft,u.world.inputs.pointer_y=e.pageY-u.canvas.offsetTop}),a(this.canvas).on("touch",o(!0)).on("release",o(!1))},n.prototype.update=function(e){},n}(x),E=function(r){function i(){return C=i.__super__.constructor.apply(this,arguments),C}return t(i,r),i.MSG_SPAWN="spawn.spawn",i.MSG_DESPAWN="spawn.despawn",i.prototype.match_component=e.Spawn,i.prototype.setWorld=function(t){var n=this;return i.__super__.setWorld.call(this,t),this.world.subscribe(i.MSG_DESPAWN,function(t,r){var i;return i=n.world.entities.get(r.entity_id,e.Spawn),i.destroy=!0})},i.prototype.update_match=function(t,r,i){var o,u,a,f,l;if(!this.world)return;u=this.world.entities.get(r,e.Position);if(i.destroy)return f=this.world.entities.get(r,e.Tombstone),f&&(a=(l=this.world.entities).create.apply(l,[new e.Spawn("at",u.x,u.y)].concat(n.call(f.components))),o=this.world.entities.groupForEntity(r),o!==null&&this.world.entities.addToGroup(o,a)),this.world.entities.destroy(r);if(!i.spawned){switch(i.position_logic){case"random":u.x=s.random(0-this.world.width/2,this.world.width/2),u.y=s.random(0-this.world.height/2,this.world.height/2);break;case"at":u.x=i.x,u.y=i.y;break;default:u.x=u.y=0}return i.spawned=!0,this.world.publish(this.constructor.MSG_SPAWN,{entity_id:r,spawn:i})}},i}(x),b=function(n){function r(e,t){this.canvas=e,this.gui_size=t!=null?t:.2,this.ctx=this.canvas.getContext("2d")}return t(r,n),r.prototype.match_component=e.Position,r.prototype.draw=function(t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m;r=this.canvas.width,n=this.canvas.height,s=this.gui_size*Math.min(r,n),v=r-s,m=0,d=s,o=s,l=d<o?d/this.world.width:o/this.world.height,this.ctx.save(),this.ctx.globalAlpha=.75,this.ctx.strokeStyle="#33c",this.ctx.fillStyle="#000",this.ctx.strokeRect(v,m,d,o),this.ctx.fillRect(v,m,d,o),this.ctx.translate(v+d/2,m+o/2),this.ctx.scale(l,l),c=1/l*2,h=this.world.entities.entitiesForGroup(this.world.current_scene);for(i in h){u=h[i],p=this.world.entities.get(i,e.Spawn),f=this.world.entities.get(i,e.Position),a=this.world.entities.get(i,e.RadarPing);if(!a||(p!=null?!p.spawned:!void 0)||!f)continue;this.ctx.fillStyle=a.color,this.ctx.strokeStyle=a.color,this.ctx.fillRect(f.x,f.y,c,c)}return this.ctx.restore()},r}(x),N=function(n){function r(e,t,n,r,i,s,o,u){this.window=e,this.game_area=t,this.canvas=n,this.window_scale_x=r!=null?r:1,this.window_scale_y=i!=null?i:1,this.zoom=s!=null?s:1,this.grid_size=o!=null?o:150,this.grid_color=u!=null?u:"#0a0a0a",this.ctx=this.canvas.getContext("2d"),this.viewport_ratio=1,this.follow_entity=null}return t(r,n),r.prototype.glow=!1,r.prototype.draw_grid=!0,r.prototype.draw_bounding_boxes=!1,r.prototype.setWorld=function(e){var t,n=this;return r.__super__.setWorld.call(this,e),this.resize(),t=function(){return n.resize()},this.window.addEventListener("resize",t,!1),this.window.addEventListener("orientationchange",t,!1)},r.prototype.setViewportSize=function(e,t){return this.viewport_width=e,this.viewport_height=t,this.viewport_ratio=this.viewport_width>this.viewport_height?this.viewport_width/this.world.width:this.viewport_height/this.world.height},r.prototype.resize=function(){var e,t,n;return n=[this.window.innerWidth,this.window.innerHeight],t=n[0],e=n[1],this.game_area.style.width=""+t+"px",this.game_area.style.height=""+e+"px",this.game_area.style.marginLeft=""+ -t/2+"px",this.game_area.style.marginTop=""+ -e/2+"px",this.canvas.width=t*this.window_scale_x,this.canvas.height=e*this.window_scale_y,this.setViewportSize(this.canvas.width,this.canvas.height)},r.prototype.draw=function(t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b;v=this.viewport_ratio*this.zoom,this.world.inputs.pointer_x&&(this.world.inputs.pointer_world_x=(this.world.inputs.pointer_x-this.viewport_width/2)/v,this.world.inputs.pointer_world_y=(this.world.inputs.pointer_y-this.viewport_height/2)/v),this.ctx.save(),this.ctx.fillStyle="rgba(0, 0, 0, 1.0)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.translate(this.viewport_width/2,this.viewport_height/2),this.ctx.scale(v,v),d=this.viewport_width/v,l=this.viewport_height/v,c=0-d/2,p=0-l/2,this.follow_entity&&(o=this.world.entities.get(this.follow_entity,e.Position),o&&(this.ctx.translate(0-o.x,0-o.y),this.world.inputs.pointer_world_x+=o.x,this.world.inputs.pointer_world_y+=o.y,this.draw_grid&&(c+=o.x,p+=o.y))),h=c+d,f=p+l;if(this.draw_grid){this.ctx.strokeStyle=this.grid_color,this.ctx.lineWidth=1,r=c%this.grid_size,u=c-r,n=c+d;for(s=m=u,y=this.grid_size;y>0?m<=n:m>=n;s=m+=y)this.ctx.moveTo(s,p),this.ctx.lineTo(s,p+l);i=p%this.grid_size,u=p-i,n=p+l;for(a=g=u,b=this.grid_size;b>0?g<=n:g>=n;a=g+=b)this.ctx.moveTo(c,a),this.ctx.lineTo(c+d,a);this.ctx.stroke()}return this.draw_scene(t,c,p,h,f),this.ctx.restore()},r.prototype.draw_scene=function(t,n,r,i,s){var o,u,a,f,l,c,h,p,d,v,m,g,y;h=this.world.entities.entitiesForGroup(this.world.current_scene),y=[];for(o in h){l=h[o],p=this.world.entities.get(o,e.Spawn);if(p!=null?!p.spawned:!void 0)continue;c=this.world.entities.get(o,e.Position);if(!c)continue;this.draw_beams(t,o,c);if(c.x<n||c.x>i)continue;if(c.y<r||c.y>s)continue;this.ctx.save(),this.ctx.translate(c.x,c.y),d=this.world.entities.get(o,e.Sprite),d&&(v=20,m=d.width,a=d.height,this.draw_bounding_boxes&&(this.ctx.strokeStyle="#33c",g=m/2,f=a/2,this.ctx.strokeRect(0-g,0-g,m,a)),this.draw_health_bar(t,o,m,a),this.draw_sprite(t,o,m,a,c,v,d)),u=this.world.entities.get(o,e.Explosion),u&&this.draw_explosion(t,o,u),y.push(this.ctx.restore())}return y},r.prototype.draw_explosion=function(e,t,n){var r,i,s,o,u,a;this.ctx.save(),this.ctx.strokeStyle=n.color,this.ctx.fillStyle=n.color,this.glow&&(this.ctx.shadowColor=n.color,this.ctx.shadowBlur=4),r=1-n.age/n.ttl,a=n.particles;for(o=0,u=a.length;o<u;o++){i=a[o];if(i.free)continue;this.ctx.globalAlpha=(1-i.r/i.mr)*r,s=i.s,this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineWidth=s,this.ctx.lineTo(i.x,i.y),this.ctx.stroke()}return this.ctx.restore()},r.prototype.draw_health_bar=function(t,n,r,i){var s,o,u,a;s=this.world.entities.get(n,e.Health);if(!s)return;return u=s.current/s.max,a=0-i/2-10,o=0-r/2,this.ctx.save(),this.ctx.lineWidth=2,this.ctx.strokeStyle="#333",this.glow&&(this.ctx.shadowColor="#333",this.ctx.shadowBlur=4),this.ctx.beginPath(),this.ctx.moveTo(o,a),this.ctx.lineTo(o+r,a),this.ctx.stroke(),u>0&&(this.ctx.strokeStyle="#3e3",this.glow&&(this.ctx.shadowColor="#3e3"),this.ctx.beginPath(),this.ctx.moveTo(o,a),this.ctx.lineTo(o+r*u,a),this.ctx.stroke()),this.ctx.restore()},r.prototype.draw_beams=function(t,n,r){var i,s,o,a,f,l,c,h,p,d,v,m,g,y,b,w,E;s=this.world.entities.get(n,e.BeamWeapon);if(!s)return;l=s.x,c=s.y,g=new u(l,c),y=new u(l,s.y-6),y.rotateAround(g,r.rotation),m=Math.PI*2/s.active_beams,E=[];for(a=b=0,w=s.active_beams-1;0<=w?b<=w:b>=w;a=0<=w?++b:--b){i=s.beams[a];if(!i)continue;this.ctx.save(),y.rotateAround(g,m),this.ctx.fillStyle=s.color,this.ctx.beginPath(),this.ctx.arc(y.x,y.y,1,0,Math.PI*2,!0),this.ctx.fill(),(i!=null?i.target:void 0)&&(i!=null?!i.charging:!void 0)&&(o=1.25,d=i.x+Math.random()*o-o/2,v=i.y+Math.random()*o-o/2,f=2,h=s.active_beams/s.max_beams,this.ctx.lineWidth=f-f*.75*h,this.ctx.strokeStyle=s.color,this.glow&&(this.ctx.shadowBlur=4,this.ctx.shadowColor=s.color),this.ctx.beginPath(),this.ctx.moveTo(y.x,y.y),this.ctx.lineTo(d,v),this.ctx.stroke()),E.push(this.ctx.restore())}return E},r.prototype.draw_sprite=function(e,t,n,r,i,s,o){var u,a;this.ctx.rotate(i.rotation),this.ctx.fillStyle="#000",this.ctx.strokeStyle=o.stroke_style,this.glow&&(this.ctx.shadowColor=o.stroke_style,this.ctx.shadowBlur=4),this.ctx.lineWidth=1.25;switch(o.shape){case"star":return this.ctx.fillStyle="#ccc",this.ctx.beginPath(),this.ctx.arc(0,0,s/2,0,Math.PI*2,!0),this.ctx.fill();case"hero":return this.ctx.rotate(Math.PI),this.ctx.beginPath(),this.ctx.moveTo(0-n*.125,0-r/2),this.ctx.lineTo(0-n*.25,0-r/2),this.ctx.lineTo(0-n*.5,0),this.ctx.arc(0,0,n/2,Math.PI,0,!0),this.ctx.lineTo(n*.25,0-r/2),this.ctx.lineTo(n*.125,0-r/2),this.ctx.lineTo(n*.25,0),this.ctx.arc(0,0,n*.25,0,Math.PI,!0),this.ctx.lineTo(0-n*.125,0-r/2),this.ctx.stroke();case"enemyscout":return this.ctx.beginPath(),this.ctx.moveTo(0,0-r*.5),this.ctx.lineTo(0-n*.45,r*.5),this.ctx.arc(0,r*.125,n*.125,Math.PI,0,!0),this.ctx.lineTo(n*.45,r*.5),this.ctx.lineTo(0,0-r*.5),this.ctx.moveTo(0,0-r*.5),this.ctx.stroke();case"enemycruiser":return u=r/5,a=n/4,this.ctx.beginPath(),this.ctx.moveTo(0,0-u*2.5),this.ctx.lineTo(-(a*1),u*.5),this.ctx.lineTo(-(a*1.25),0-u*1.5),this.ctx.lineTo(-(a*2),u*2.5),this.ctx.arc(0-a,u*2.5,n*.25,Math.PI,Math.PI/2,!0),this.ctx.lineTo(-a*.5,u*2.5),this.ctx.arc(0,u*2.5,n*.125,Math.PI,0,!0),this.ctx.lineTo(a,u*3.75),this.ctx.arc(a,u*2.5,n*.25,Math.PI/2,0,!0),this.ctx.lineTo(a*1.25,0-u*1.5),this.ctx.lineTo(a*1,u*.5),this.ctx.lineTo(0,0-u*2.5),this.ctx.stroke();case"torpedo":return this.ctx.beginPath(),this.ctx.moveTo(0-n*.5,0),this.ctx.arc(0-n*.5,0-r*.5,n*.5,Math.PI*.5,0,!0),this.ctx.moveTo(0,0-r*.5),this.ctx.arc(n*.5,0-r*.5,n*.5,Math.PI,Math.PI*.5,!0),this.ctx.moveTo(0,r*.5),this.ctx.arc(n*.5,r*.5,n*.5,Math.PI*1,Math.PI*1.5,!1),this.ctx.moveTo(0-n*.5,0),this.ctx.arc(0-n*.5,r*.5,n*.5,Math.PI*1.5,0,!1),this.ctx.stroke();default:return this.ctx.beginPath(),this.ctx.arc(0,0,s/2,0,Math.PI*2,!0),this.ctx.stroke()}},r}(x),p=function(n){function i(){}return t(i,n),i.prototype.match_component=e.Collidable,i.prototype.update=function(t){var n,i,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O;b=this.world.entities.getComponents(this.match_component),d={},C=[0,1,2,3,4],n=C[0],o=C[1],u=C[2],i=C[3],a=C[4];for(m in b)v=b[m],k=this.world.entities.get(m,e.Position,e.Sprite),w=k[0],E=k[1],d[m]=[v,w.x,w.y,E.width,E.height];L=this.combinations(s.keys(d),2),O=[];for(T=0,N=L.length;T<N;T++)A=L[T],l=A[0],p=A[1],f=d[l],h=d[p],y=Math.abs(f[o]-h[o])*2,S=Math.abs(f[u]-h[u])*2,x=f[a]+h[a],g=f[i]+h[i],c=p in f[n].in_collision_with&&l in h[n].in_collision_with,y<x&&S<g?c?O.push(void 0):(f[n].in_collision_with[p]=r.now(),O.push(h[n].in_collision_with[l]=r.now())):c?(delete f[n].in_collision_with[p],O.push(delete h[n].in_collision_with[l])):O.push(void 0);return O},i.prototype.combinations=function(e,t){var n,r,i,s,o,u,a,f,l;i=[];if(e.length>0)for(n=u=0,f=e.length-1;0<=f?u<=f:u>=f;n=0<=f?++u:--u)if(t===1)i.push([e[n]]);else{s=this.combinations(e.slice(n+1,e.length),t-1);if(s.length>0)for(o=a=0,l=s.length-1;0<=l?a<=l:a>=l;o=0<=l?++a:--a)r=s[o],r.unshift(e[n]),i.push(r)}return i},i}(x),c=function(n){function r(){return k=r.__super__.constructor.apply(this,arguments),k}return t(r,n),r.prototype.match_component=e.Bouncer,r.prototype.update_match=function(t,n,r){var i,o,u,a,f;return f=this.world.entities.get(n,e.Position,e.Collidable),o=f[0],i=f[1],i&&s.keys(i.in_collision_with).length>0&&(r.x_dir=0-r.x_dir,r.y_dir=0-r.y_dir),u=this.world.width/2,a=this.world.height/2,o.x>u&&(r.x_dir=-1),o.x<-u&&(r.x_dir=1),o.y>a&&(r.y_dir=-1),o.y<-a&&(r.y_dir=1),o.x+=r.x_dir*t*r.x_sec,o.y+=r.y_dir*t*r.y_sec},r}(x),S=function(n){function r(){return L=r.__super__.constructor.apply(this,arguments),L}return t(r,n),r.prototype.match_component=e.Spin,r.prototype.update_match=function(t,n,r){var i,s;return s=this.world.entities.get(n,e.Position),i=t*r.rad_per_sec,s.rotation=(s.rotation+i)%(Math.PI*2)},r}(x),g=function(n){function r(){this.v_orbited=new u,this.v_orbiter=new u,this.v_old=new u}return t(r,n),r.prototype.match_component=e.Orbit,r.prototype.update_match=function(t,n,r){var i,s,o;o=this.world.entities.get(n,e.Position),s=this.world.entities.get(r.orbited_id,e.Position),this.v_orbited.setValues(s.x,s.y),this.v_orbiter.setValues(o.x,o.y),i=t*r.rad_per_sec,this.v_orbiter.rotateAround(this.v_orbited,i),this.v_old.setValues(o.x,o.y),o.x=this.v_orbiter.x,o.y=this.v_orbiter.y;if(r.rotate)return o.rotation=this.v_old.angleTo(this.v_orbiter)+Math.PI*.5},r}(x),w=function(n){function r(){this.v_seeker=new u,this.v_target=new u}return t(r,n),r.prototype.match_component=e.Seeker,r.prototype.update_match=function(t,n,r){var i,o,u,a,f,l;if(!r.target)return;a=this.world.entities.get(n,e.Position);if(!a)return;l=r.target,s.isObject(l)||(l=this.world.entities.get(r.target,e.Position));if(!l||!l.x&&l.y)return;this.v_seeker.setValues(a.x,a.y),this.v_target.setValues(l.x,l.y),f=this.v_seeker.angleTo(this.v_target)+Math.PI*.5,f<0&&(f+=2*Math.PI),o=f<a.rotation?-1:1,u=Math.abs(f-a.rotation),u>Math.PI&&(o=0-o),i=t*r.rad_per_sec,i>u&&(i=u),a.rotation=(a.rotation+o*i)%(Math.PI*2);if(a.rotation<0)return a.rotation+=2*Math.PI},r}(x),T=function(n){function r(){this.v_inertia=new u,this.v_thrust=new u}return t(r,n),r.prototype.match_component=e.Thruster,r.prototype.update_match=function(t,n,r){var i,s,o,u;return o=this.world.entities.get(n,e.Position),this.v_inertia.setValues(r.dx,r.dy),u=t*r.dv,r.active?(this.v_thrust.setValues(0,0-u),this.v_thrust.rotate(o.rotation),this.v_inertia.add(this.v_thrust),i=this.v_inertia.magnitude(),i>r.max_v&&(s=r.max_v/i,this.v_inertia.multiplyScalar(s))):(this.v_inertia.addScalar(0-u),this.v_inertia.x<0&&(this.v_inertia.x=0),this.v_inertia.y<0&&(this.v_inertia.y=0)),r.dx=this.v_inertia.x,r.dy=this.v_inertia.y,o.x+=t*r.dx,o.y+=t*r.dy},r}(x),h=function(n){function r(){return A=r.__super__.constructor.apply(this,arguments),A}return t(r,n),r.prototype.match_component=e.ClickCourse,r.prototype.update_match=function(t,n,r){var i,s,o,u,a,f;i=this.world.entities.get(n,e.Position),o=this.world.entities.get(n,e.Sprite),s=this.world.entities.get(n,e.Seeker),u=this.world.entities.get(n,e.Thruster),r.active&&this.world.inputs.pointer_button_left&&(r.x=this.world.inputs.pointer_world_x,r.y=this.world.inputs.pointer_world_y,u!=null&&(u.active=!0),s!=null&&(s.target={x:r.x,y:r.y})),a=Math.abs(i.x-r.x),f=Math.abs(i.y-r.y);if(a<o.width/2&&f<o.height/2)return r.stop_on_arrival&&u!=null&&(u.active=!1),s!=null?s.target=null:void 0},r}(x),l=function(n){function r(){this.v_beam=new u,this.v_target=new u,this.stats={}}return t(r,n),r.DAMAGE_TYPE="Beam",r.prototype.match_component=e.BeamWeapon,r.prototype.calculate_stats=function(e){var t,n,r;return n=""+e.active_beams+":"+e.max_power,n in this.stats||(t=e.active_beams,r=e.active_beams/e.max_beams,this.stats[n]={max_charge:e.max_power/(t*t),charge_rate:e.charge_rate/t,discharge_rate:e.discharge_rate/t,beam_range:e.max_range/e.active_beams,dmg_penalty:1-r*e.dmg_penalty}),this.stats[n]},r.prototype.update_match=function(t,n,r){var i,o,u,a,f,l,c,h,p,d,m,g,y,b,w,E,S,x,T,N,C;c=this.world.entities.get(n,e.Position),r.x=c.x,r.y=c.y,this.v_beam.setValues(c.x,c.y),r.active_beams=Math.min(r.active_beams,r.max_beams);if(r.active_beams===0)return;h=this.calculate_stats(r),o=[];for(l=b=0,x=r.active_beams-1;0<=x?b<=x:b>=x;l=0<=x?++b:--b)i=r.beams[l],i.charging&&(i.charge+=h.charge_rate*t,i.charge>=h.max_charge&&(i.charge=h.max_charge,i.charging=!1,i.target=null,o.push(i)));if(o.length>0){y=this.world.entities.getComponents(e.WeaponsTarget),u=[];for(p in y){g=y[p];if(p===n)continue;if(g.team!==r.target_team)continue;d=this.world.entities.get(p,e.Position),this.v_target.setValues(d.x,d.y),m=this.v_beam.dist(this.v_target),m<=h.beam_range&&u.push([m,p,d])}if(u.length){s.sortBy(u,function(e){return e[0]});while(o.length)for(w=0,S=u.length;w<S;w++){T=u[w],m=T[0],p=T[1],d=T[2],i=o.pop();if(!i)break;i.target=p}}}C=[];for(l=E=0,N=r.active_beams-1;0<=N?E<=N:E>=N;l=0<=N?++E:--E){i=r.beams[l];if(i.charging)continue;d=this.world.entities.get(i.target,e.Position),d&&(i.x=d.x,i.y=d.y),a=h.discharge_rate*t,i.charge<a&&(a=i.charge),i.charge-=a,i.charge<=0&&(i.charge=0,i.charging=!0),f=a*h.dmg_penalty,C.push(this.world.publish(v.MSG_DAMAGE,{to:i.target,from:n,kind:this.constructor.DAMAGE_TYPE,amount:f}))}return C},r}(x),v=function(n){function r(){return O=r.__super__.constructor.apply(this,arguments),O}return t(r,n),r.MSG_DAMAGE="health.damage",r.MSG_HEAL="health.heal",r.prototype.match_component=e.Health,r.prototype.setWorld=function(t){var n=this;return r.__super__.setWorld.call(this,t),this.world.subscribe(this.constructor.MSG_DAMAGE,function(t,r){var i;i=n.world.entities.get(r.to,e.Health);if(!i)return;return i.current-=r.amount}),this.world.subscribe(this.constructor.MSG_HEAL,function(t,r){var i;i=n.world.entities.get(r.to,e.Health);if(!i)return;return i.health+=r.amount})},r.prototype.update_match=function(e,t,n){if(n.current<0)return this.world.publish(E.MSG_DESPAWN,{entity_id:t})},r}(x),d=function(n){function r(){this.v_center=new u(0,0),this.v_scratch=new u(0,0)}return t(r,n),r.prototype.match_component=e.Explosion,r.prototype.update_match=function(e,t,n){var r,i,s,o,u,a,f,l;f=n.particles;for(s=0,u=f.length;s<u;s++)i=f[s],!n.stop&&i.free&&(i.x=i.y=0,this.v_scratch.setValues(0,n.max_velocity*Math.random()),this.v_scratch.rotateAround(this.v_center,Math.PI*2*Math.random()),i.dx=this.v_scratch.x,i.dy=this.v_scratch.y,i.mr=n.radius*Math.random(),i.s=n.max_particle_size,i.free=!1),i.free||(i.x+=i.dx*e,i.y+=i.dy*e,this.v_scratch.setValues(i.x,i.y),i.r=this.v_scratch.dist(this.v_center),i.r>=i.mr&&(i.r=i.mr,i.free=!0));n.age+=e,!n.stop&&n.age>=n.ttl*.75&&(n.stop=!0);if(n.stop){r=!0,l=n.particles;for(o=0,a=l.length;o<a;o++){i=l[o];if(!i.free){r=!1;break}}if(r||n.age>=n.ttl)return n.age=n.ttl,this.world.publish(E.MSG_DESPAWN,{entity_id:t})}},r}(x),{System:x,SpawnSystem:E,BouncerSystem:c,SpinSystem:S,OrbiterSystem:g,ViewportSystem:N,PointerInputSystem:y,CollisionSystem:p,SeekerSystem:w,ThrusterSystem:T,ClickCourseSystem:h,KeyboardInputSystem:m,BeamWeaponSystem:l,HealthSystem:v,ExplosionSystem:d,RadarSystem:b}})}).call(this);