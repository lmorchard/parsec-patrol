/*!
 * mocha
 * Copyright(c) 2011 TJ Holowaychuk <tj@vision-media.ca>
 * MIT Licensed
 */

function image(e){return __dirname+"/../images/"+e+".png"}function Mocha(e){e=e||{},this.files=[],this.options=e,this.grep(e.grep),this.suite=new exports.Suite("",new exports.Context),this.ui(e.ui),this.bail(e.bail),this.reporter(e.reporter),e.timeout&&this.timeout(e.timeout),e.slow&&this.slow(e.slow)}var path=require("path"),utils=require("./utils");exports=module.exports=Mocha,exports.utils=utils,exports.interfaces=require("./interfaces"),exports.reporters=require("./reporters"),exports.Runnable=require("./runnable"),exports.Context=require("./context"),exports.Runner=require("./runner"),exports.Suite=require("./suite"),exports.Hook=require("./hook"),exports.Test=require("./test"),Mocha.prototype.bail=function(e){return 0==arguments.length&&(e=!0),this.suite.bail(e),this},Mocha.prototype.addFile=function(e){return this.files.push(e),this},Mocha.prototype.reporter=function(e){if("function"==typeof e)this._reporter=e;else{e=e||"dot";try{this._reporter=require("./reporters/"+e)}catch(t){this._reporter=require(e)}if(!this._reporter)throw new Error('invalid reporter "'+e+'"')}return this},Mocha.prototype.ui=function(e){e=e||"bdd",this._ui=exports.interfaces[e];if(!this._ui)throw new Error('invalid interface "'+e+'"');return this._ui=this._ui(this.suite),this},Mocha.prototype.loadFiles=function(e){var t=this,n=this.suite,r=this.files.length;this.files.forEach(function(i){i=path.resolve(i),n.emit("pre-require",global,i,t),n.emit("require",require(i),i,t),n.emit("post-require",global,i,t),--r||e&&e()})},Mocha.prototype._growl=function(e,t){var n=require("growl");e.on("end",function(){var r=t.stats;if(r.failures){var i=r.failures+" of "+e.total+" tests failed";n(i,{name:"mocha",title:"Failed",image:image("error")})}else n(r.passes+" tests passed in "+r.duration+"ms",{name:"mocha",title:"Passed",image:image("ok")})})},Mocha.prototype.grep=function(e){return this.options.grep="string"==typeof e?new RegExp(utils.escapeRegexp(e)):e,this},Mocha.prototype.invert=function(){return this.options.invert=!0,this},Mocha.prototype.ignoreLeaks=function(){return this.options.ignoreLeaks=!0,this},Mocha.prototype.checkLeaks=function(){return this.options.ignoreLeaks=!1,this},Mocha.prototype.growl=function(){return this.options.growl=!0,this},Mocha.prototype.globals=function(e){return this.options.globals=(this.options.globals||[]).concat(e),this},Mocha.prototype.timeout=function(e){return this.suite.timeout(e),this},Mocha.prototype.slow=function(e){return this.suite.slow(e),this},Mocha.prototype.asyncOnly=function(){return this.options.asyncOnly=!0,this},Mocha.prototype.run=function(e){this.files.length&&this.loadFiles();var t=this.suite,n=this.options,r=new exports.Runner(t),i=new this._reporter(r);return r.ignoreLeaks=!1!==n.ignoreLeaks,r.asyncOnly=n.asyncOnly,n.grep&&r.grep(n.grep,n.invert),n.globals&&r.globals(n.globals),n.growl&&this._growl(r,i),r.run(e)};