function JSONCov(e,t){var n=this,t=1==arguments.length?!0:t;Base.call(this,e);var r=[],i=[],s=[];e.on("test end",function(e){r.push(e)}),e.on("pass",function(e){s.push(e)}),e.on("fail",function(e){i.push(e)}),e.on("end",function(){var e=global._$jscoverage||{},o=n.cov=map(e);o.stats=n.stats,o.tests=r.map(clean),o.failures=i.map(clean),o.passes=s.map(clean);if(!t)return;process.stdout.write(JSON.stringify(o,null,2))})}function map(e){var t={instrumentation:"node-jscoverage",sloc:0,hits:0,misses:0,coverage:0,files:[]};for(var n in e){var r=coverage(n,e[n]);t.files.push(r),t.hits+=r.hits,t.misses+=r.misses,t.sloc+=r.sloc}return t.files.sort(function(e,t){return e.filename.localeCompare(t.filename)}),t.sloc>0&&(t.coverage=t.hits/t.sloc*100),t}function coverage(e,t){var n={filename:e,coverage:0,hits:0,misses:0,sloc:0,source:{}};return t.source.forEach(function(e,r){r++,t[r]===0?(n.misses++,n.sloc++):t[r]!==undefined&&(n.hits++,n.sloc++),n.source[r]={source:e,coverage:t[r]===undefined?"":t[r]}}),n.coverage=n.hits/n.sloc*100,n}function clean(e){return{title:e.title,fullTitle:e.fullTitle(),duration:e.duration}}var Base=require("./base");exports=module.exports=JSONCov;