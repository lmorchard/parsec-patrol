function HTML(e,t){Base.call(this,e);var n=this,r=this.stats,i=e.total,s=fragment(statsTemplate),o=s.getElementsByTagName("li"),u=o[1].getElementsByTagName("em")[0],a=o[1].getElementsByTagName("a")[0],f=o[2].getElementsByTagName("em")[0],l=o[2].getElementsByTagName("a")[0],c=o[3].getElementsByTagName("em")[0],h=s.getElementsByTagName("canvas")[0],p=fragment('<ul id="mocha-report"></ul>'),d=[p],v,m;t=t||document.getElementById("mocha");if(h.getContext){var g=window.devicePixelRatio||1;h.style.width=h.width,h.style.height=h.height,h.width*=g,h.height*=g,m=h.getContext("2d"),m.scale(g,g),v=new Progress}if(!t)return error("#mocha div missing, add it to your document");on(a,"click",function(){unhide();var e=/pass/.test(p.className)?"":" pass";p.className=p.className.replace(/fail|pass/g,"")+e,p.className.trim()&&hideSuitesWithout("test pass")}),on(l,"click",function(){unhide();var e=/fail/.test(p.className)?"":" fail";p.className=p.className.replace(/fail|pass/g,"")+e,p.className.trim()&&hideSuitesWithout("test fail")}),t.appendChild(s),t.appendChild(p),v&&v.size(40),e.on("suite",function(e){if(e.root)return;var t="?grep="+encodeURIComponent(e.fullTitle()),n=fragment('<li class="suite"><h1><a href="%s">%s</a></h1></li>',t,escape(e.title));d[0].appendChild(n),d.unshift(document.createElement("ul")),n.appendChild(d[0])}),e.on("suite end",function(e){if(e.root)return;d.shift()}),e.on("fail",function(t,n){"hook"==t.type&&e.emit("test end",t)}),e.on("test end",function(e){var t=r.tests/this.total*100|0;v&&v.update(t).draw(m);var n=new Date-r.start;text(u,r.passes),text(f,r.failures),text(c,(n/1e3).toFixed(2));if("passed"==e.state)var i=fragment('<li class="test pass %e"><h2>%e<span class="duration">%ems</span> <a href="?grep=%e" class="replay">‣</a></h2></li>',e.speed,e.title,e.duration,encodeURIComponent(e.fullTitle()));else if(e.pending)var i=fragment('<li class="test pass pending"><h2>%e</h2></li>',e.title);else{var i=fragment('<li class="test fail"><h2>%e <a href="?grep=%e" class="replay">‣</a></h2></li>',e.title,encodeURIComponent(e.fullTitle())),s=e.err.stack||e.err.toString();~s.indexOf(e.err.message)||(s=e.err.message+"\n"+s),"[object Error]"==s&&(s=e.err.message),!e.err.stack&&e.err.sourceURL&&e.err.line!==undefined&&(s+="\n("+e.err.sourceURL+":"+e.err.line+")"),i.appendChild(fragment('<pre class="error">%e</pre>',s))}if(!e.pending){var o=i.getElementsByTagName("h2")[0];on(o,"click",function(){a.style.display="none"==a.style.display?"block":"none"});var a=fragment("<pre><code>%e</code></pre>",utils.clean(e.fn.toString()));i.appendChild(a),a.style.display="none"}d[0]&&d[0].appendChild(i)})}function error(e){document.body.appendChild(fragment('<div id="mocha-error">%s</div>',e))}function fragment(e){var t=arguments,n=document.createElement("div"),r=1;return n.innerHTML=e.replace(/%([se])/g,function(e,n){switch(n){case"s":return String(t[r++]);case"e":return escape(t[r++])}}),n.firstChild}function hideSuitesWithout(e){var t=document.getElementsByClassName("suite");for(var n=0;n<t.length;n++){var r=t[n].getElementsByClassName(e);0==r.length&&(t[n].className+=" hidden")}}function unhide(){var e=document.getElementsByClassName("suite hidden");for(var t=0;t<e.length;++t)e[t].className=e[t].className.replace("suite hidden","suite")}function text(e,t){e.textContent?e.textContent=t:e.innerText=t}function on(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)}var Base=require("./base"),utils=require("../utils"),Progress=require("../browser/progress"),escape=utils.escape,Date=global.Date,setTimeout=global.setTimeout,setInterval=global.setInterval,clearTimeout=global.clearTimeout,clearInterval=global.clearInterval;exports=module.exports=HTML;var statsTemplate='<ul id="mocha-stats"><li class="progress"><canvas width="40" height="40"></canvas></li><li class="passes"><a href="#">passes:</a> <em>0</em></li><li class="failures"><a href="#">failures:</a> <em>0</em></li><li class="duration">duration: <em>0</em>s</li></ul>';