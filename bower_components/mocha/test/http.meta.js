function get(e,t,n){return function(r){http.get({path:e,port:8889,headers:n},function(e){var n="";e.should.have.status(200),e.setEncoding("utf8"),e.on("data",function(e){n+=e}),e.on("end",function(){n.should.equal(t),r()})})}}var http=require("http"),server=http.createServer(function(e,t){var n=e.headers.accept||"",r=~n.indexOf("json");switch(e.url){case"/":t.end("hello");break;case"/users":r?t.end('["tobi","loki","jane"]'):t.end("tobi, loki, jane")}});server.listen(8889),describe("http requests",function(){describe("GET /",function(){it("should respond with hello",get("/","hello"))}),describe("GET /users",function(){it("should respond with users",get("/users","tobi, loki, jane")),it("should respond with users",get("/users",'["tobi","loki","jane"]',{Accept:"application/json"}))})});