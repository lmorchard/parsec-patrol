function get(e){function i(t){http.get({path:e,port:8899,headers:r},function(e){var r="";e.should.have.status(200),e.setEncoding("utf8"),e.on("data",function(e){r+=e}),e.on("end",function(){r.should.equal(n),t()})})}var t,n,r={};return{set:function(e,t){return r[e]=t,this},should:{respond:function(s){t=Object.keys(r).map(function(e){return e+": "+r[e]}).join(", "),n=s,describe("GET "+e,function(){t?describe("when given "+t,function(){it('should respond with "'+s+'"',i)}):it('should respond with "'+s+'"',i)})}}}}var http=require("http"),server=http.createServer(function(e,t){var n=e.headers.accept||"",r=~n.indexOf("json");switch(e.url){case"/":t.end("hello");break;case"/users":r?t.end('["tobi","loki","jane"]'):t.end("tobi, loki, jane")}});server.listen(8899),describe("http server",function(){get("/").should.respond("hello"),get("/users").should.respond("tobi, loki, jane"),get("/users").set("Accept","application/json").should.respond('["tobi","loki","jane"]')});