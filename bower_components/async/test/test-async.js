function eachIterator(e,t,n){setTimeout(function(){e.push(t),n()},t*25)}function mapIterator(e,t,n){setTimeout(function(){e.push(t),n(null,t*2)},t*25)}function filterIterator(e,t){setTimeout(function(){t(e%2)},e*25)}function detectIterator(e,t,n){setTimeout(function(){e.push(t),n(t==2)},t*25)}function eachNoCallbackIterator(e,t,n){e.equal(t,1),n(),e.done()}function getFunctionsObject(e){return{one:function(t){setTimeout(function(){e.push(1),t(null,1)},125)},two:function(t){setTimeout(function(){e.push(2),t(null,2)},200)},three:function(t){setTimeout(function(){e.push(3),t(null,3,3)},50)}}}var async=require("../lib/async");Function.prototype.bind||(Function.prototype.bind=function(e){var t=Array.prototype.slice.call(arguments,1),n=this;return function(){n.apply(e,t.concat(Array.prototype.slice.call(arguments)))}}),exports.compose=function(e){e.expect(4);var t=function(t,n){e.equal(t,3),setTimeout(function(){n(null,t+2)},50)},n=function(t,n){e.equal(t,5),setTimeout(function(){n(null,t*3)},15)},r=function(t,n){e.equal(t,15),setTimeout(function(){n(null,t+1)},100)},i=async.compose(r,n,t);i(3,function(t,n){if(t)return e.done(t);e.equal(n,16),e.done()})},exports["compose error"]=function(e){e.expect(3);var t=new Error("test"),n=function(t,n){e.equal(t,3),setTimeout(function(){n(null,t+2)},50)},r=function(n,r){e.equal(n,5),setTimeout(function(){r(t)},15)},i=function(t,n){e.ok(!1,"add1 should not get called"),setTimeout(function(){n(null,t+1)},100)},s=async.compose(i,r,n);s(3,function(n,r){e.equal(n,t),e.done()})},exports["compose binding"]=function(e){e.expect(4);var t=new Error("test"),n={name:"foo"},r=function(t,r){e.equal(this,n),setTimeout(function(){r(null,t+2)},50)},i=function(t,r){e.equal(this,n),setTimeout(function(){r(null,t*3)},15)},s=async.compose(i,r);s.call(n,3,function(t,r){if(t)return e.done(t);e.equal(this,n),e.equal(r,15),e.done()})},exports.auto=function(e){var t=[],n=[{test:"test"}];async.auto({task1:["task2",function(e){setTimeout(function(){t.push("task1"),e()},25)}],task2:function(e){setTimeout(function(){t.push("task2"),e()},50)},task3:["task2",function(e){t.push("task3"),e()}],task4:["task1","task2",function(e){t.push("task4"),e()}],task5:["task2",function(e){setTimeout(function(){t.push("task5"),e()},0)}],task6:["task2",function(e){t.push("task6"),e()}]},function(n){e.same(t,["task2","task6","task3","task5","task1","task4"]),e.done()})},exports["auto petrify"]=function(e){var t=[];async.auto({task1:["task2",function(e){setTimeout(function(){t.push("task1"),e()},100)}],task2:function(e){setTimeout(function(){t.push("task2"),e()},200)},task3:["task2",function(e){t.push("task3"),e()}],task4:["task1","task2",function(e){t.push("task4"),e()}]},function(n){e.same(t,["task2","task3","task1","task4"]),e.done()})},exports["auto results"]=function(e){var t=[];async.auto({task1:["task2",function(n,r){e.same(r.task2,"task2"),setTimeout(function(){t.push("task1"),n(null,"task1a","task1b")},25)}],task2:function(e){setTimeout(function(){t.push("task2"),e(null,"task2")},50)},task3:["task2",function(n,r){e.same(r.task2,"task2"),t.push("task3"),n(null)}],task4:["task1","task2",function(n,r){e.same(r.task1,["task1a","task1b"]),e.same(r.task2,"task2"),t.push("task4"),n(null,"task4")}]},function(n,r){e.same(t,["task2","task3","task1","task4"]),e.same(r,{task1:["task1a","task1b"],task2:"task2",task3:undefined,task4:"task4"}),e.done()})},exports["auto empty object"]=function(e){async.auto({},function(t){e.done()})},exports["auto error"]=function(e){e.expect(1),async.auto({task1:function(e){e("testerror")},task2:["task1",function(t){e.ok(!1,"task2 should not be called"),t()}],task3:function(e){e("testerror2")}},function(t){e.equals(t,"testerror")}),setTimeout(e.done,100)},exports["auto no callback"]=function(e){async.auto({task1:function(e){e()},task2:["task1",function(t){t(),e.done()}]})},exports["auto removeListener has side effect on loop iterator"]=function(e){async.auto({task1:["task3",function(t){e.done()}],task2:["task3",function(e){}],task3:function(e){e()}})},exports.waterfall=function(e){e.expect(6);var t=[];async.waterfall([function(e){t.push("fn1"),setTimeout(function(){e(null,"one","two")},0)},function(n,r,i){t.push("fn2"),e.equals(n,"one"),e.equals(r,"two"),setTimeout(function(){i(null,n,r,"three")},25)},function(n,r,i,s){t.push("fn3"),e.equals(n,"one"),e.equals(r,"two"),e.equals(i,"three"),s(null,"four")},function(n,r){t.push("fn4"),e.same(t,["fn1","fn2","fn3","fn4"]),r(null,"test")}],function(t){e.done()})},exports["waterfall empty array"]=function(e){async.waterfall([],function(t){e.done()})},exports["waterfall no callback"]=function(e){async.waterfall([function(e){e()},function(t){t(),e.done()}])},exports["waterfall async"]=function(e){var t=[];async.waterfall([function(e){t.push(1),e(),t.push(2)},function(e){t.push(3),e()},function(){e.same(t,[1,2,3]),e.done()}])},exports["waterfall error"]=function(e){e.expect(1),async.waterfall([function(e){e("error")},function(t){e.ok(!1,"next function should not be called"),t()}],function(t){e.equals(t,"error")}),setTimeout(e.done,50)},exports["waterfall multiple callback calls"]=function(e){var t=[],n=[function(e){t.push(1),e(null,"one","two"),e(null,"one","two")},function(e,n,r){t.push(2),r(null,e,n,"three")},function(e,n,r,i){t.push(3),i(null,"four")},function(r){t.push(4),n[3]=function(){t.push(4),e.same(t,[1,2,2,3,3,4,4]),e.done()}}];async.waterfall(n)},exports.parallel=function(e){var t=[];async.parallel([function(e){setTimeout(function(){t.push(1),e(null,1)},50)},function(e){setTimeout(function(){t.push(2),e(null,2)},100)},function(e){setTimeout(function(){t.push(3),e(null,3,3)},25)}],function(n,r){e.equals(n,null),e.same(t,[3,1,2]),e.same(r,[1,2,[3,3]]),e.done()})},exports["parallel empty array"]=function(e){async.parallel([],function(t,n){e.equals(t,null),e.same(n,[]),e.done()})},exports["parallel error"]=function(e){async.parallel([function(e){e("error",1)},function(e){e("error2",2)}],function(t,n){e.equals(t,"error")}),setTimeout(e.done,100)},exports["parallel no callback"]=function(e){async.parallel([function(e){e()},function(t){t(),e.done()}])},exports["parallel object"]=function(e){var t=[];async.parallel(getFunctionsObject(t),function(n,r){e.equals(n,null),e.same(t,[3,1,2]),e.same(r,{one:1,two:2,three:[3,3]}),e.done()})},exports["parallel limit"]=function(e){var t=[];async.parallelLimit([function(e){setTimeout(function(){t.push(1),e(null,1)},50)},function(e){setTimeout(function(){t.push(2),e(null,2)},100)},function(e){setTimeout(function(){t.push(3),e(null,3,3)},25)}],2,function(n,r){e.equals(n,null),e.same(t,[1,3,2]),e.same(r,[1,2,[3,3]]),e.done()})},exports["parallel limit empty array"]=function(e){async.parallelLimit([],2,function(t,n){e.equals(t,null),e.same(n,[]),e.done()})},exports["parallel limit error"]=function(e){async.parallelLimit([function(e){e("error",1)},function(e){e("error2",2)}],1,function(t,n){e.equals(t,"error")}),setTimeout(e.done,100)},exports["parallel limit no callback"]=function(e){async.parallelLimit([function(e){e()},function(t){t(),e.done()}],1)},exports["parallel limit object"]=function(e){var t=[];async.parallelLimit(getFunctionsObject(t),2,function(n,r){e.equals(n,null),e.same(t,[1,3,2]),e.same(r,{one:1,two:2,three:[3,3]}),e.done()})},exports.series=function(e){var t=[];async.series([function(e){setTimeout(function(){t.push(1),e(null,1)},25)},function(e){setTimeout(function(){t.push(2),e(null,2)},50)},function(e){setTimeout(function(){t.push(3),e(null,3,3)},15)}],function(n,r){e.equals(n,null),e.same(r,[1,2,[3,3]]),e.same(t,[1,2,3]),e.done()})},exports["series empty array"]=function(e){async.series([],function(t,n){e.equals(t,null),e.same(n,[]),e.done()})},exports["series error"]=function(e){e.expect(1),async.series([function(e){e("error",1)},function(t){e.ok(!1,"should not be called"),t("error2",2)}],function(t,n){e.equals(t,"error")}),setTimeout(e.done,100)},exports["series no callback"]=function(e){async.series([function(e){e()},function(t){t(),e.done()}])},exports["series object"]=function(e){var t=[];async.series(getFunctionsObject(t),function(n,r){e.equals(n,null),e.same(r,{one:1,two:2,three:[3,3]}),e.same(t,[1,2,3]),e.done()})},exports.iterator=function(e){var t=[],n=async.iterator([function(){t.push(1)},function(n){e.equals(n,"arg1"),t.push(2)},function(n,r){e.equals(n,"arg1"),e.equals(r,"arg2"),t.push(3)}]);n(),e.same(t,[1]);var r=n();e.same(t,[1,1]);var i=r("arg1");e.same(t,[1,1,2]);var s=i("arg1","arg2");e.same(t,[1,1,2,3]),e.equals(s,undefined),e.done()},exports["iterator empty array"]=function(e){var t=async.iterator([]);e.equals(t(),undefined),e.equals(t.next(),undefined),e.done()},exports["iterator.next"]=function(e){var t=[],n=async.iterator([function(){t.push(1)},function(n){e.equals(n,"arg1"),t.push(2)},function(n,r){e.equals(n,"arg1"),e.equals(r,"arg2"),t.push(3)}]),r=n.next(),i=r("arg1");e.same(t,[2]),i("arg1","arg2"),e.same(t,[2,3]),e.equals(i.next(),undefined),e.done()},exports.each=function(e){var t=[];async.each([1,3,2],eachIterator.bind(this,t),function(n){e.same(t,[1,2,3]),e.done()})},exports["each extra callback"]=function(e){var t=0;async.each([1,3,2],function(n,r){t++,r(),e.throws(r),t==3&&e.done()})},exports["each empty array"]=function(e){e.expect(1),async.each([],function(t,n){e.ok(!1,"iterator should not be called"),n()},function(t){e.ok(!0,"should call callback")}),setTimeout(e.done,25)},exports["each error"]=function(e){e.expect(1),async.each([1,2,3],function(e,t){t("error")},function(t){e.equals(t,"error")}),setTimeout(e.done,50)},exports["each no callback"]=function(e){async.each([1],eachNoCallbackIterator.bind(this,e))},exports["forEach alias"]=function(e){e.strictEqual(async.each,async.forEach),e.done()},exports.eachSeries=function(e){var t=[];async.eachSeries([1,3,2],eachIterator.bind(this,t),function(n){e.same(t,[1,3,2]),e.done()})},exports["eachSeries empty array"]=function(e){e.expect(1),async.eachSeries([],function(t,n){e.ok(!1,"iterator should not be called"),n()},function(t){e.ok(!0,"should call callback")}),setTimeout(e.done,25)},exports["eachSeries error"]=function(e){e.expect(2);var t=[];async.eachSeries([1,2,3],function(e,n){t.push(e),n("error")},function(n){e.same(t,[1]),e.equals(n,"error")}),setTimeout(e.done,50)},exports["eachSeries no callback"]=function(e){async.eachSeries([1],eachNoCallbackIterator.bind(this,e))},exports["forEachSeries alias"]=function(e){e.strictEqual(async.eachSeries,async.forEachSeries),e.done()},exports.eachLimit=function(e){var t=[],n=[0,1,2,3,4,5,6,7,8,9];async.eachLimit(n,2,function(e,n){setTimeout(function(){t.push(e),n()},e*5)},function(r){e.same(t,n),e.done()})},exports["eachLimit empty array"]=function(e){e.expect(1),async.eachLimit([],2,function(t,n){e.ok(!1,"iterator should not be called"),n()},function(t){e.ok(!0,"should call callback")}),setTimeout(e.done,25)},exports["eachLimit limit exceeds size"]=function(e){var t=[],n=[0,1,2,3,4,5,6,7,8,9];async.eachLimit(n,20,eachIterator.bind(this,t),function(r){e.same(t,n),e.done()})},exports["eachLimit limit equal size"]=function(e){var t=[],n=[0,1,2,3,4,5,6,7,8,9];async.eachLimit(n,10,eachIterator.bind(this,t),function(r){e.same(t,n),e.done()})},exports["eachLimit zero limit"]=function(e){e.expect(1),async.eachLimit([0,1,2,3,4,5],0,function(t,n){e.ok(!1,"iterator should not be called"),n()},function(t){e.ok(!0,"should call callback")}),setTimeout(e.done,25)},exports["eachLimit error"]=function(e){e.expect(2);var t=[0,1,2,3,4,5,6,7,8,9],n=[];async.eachLimit(t,3,function(e,t){n.push(e),e===2&&t("error")},function(t){e.same(n,[0,1,2]),e.equals(t,"error")}),setTimeout(e.done,25)},exports["eachLimit no callback"]=function(e){async.eachLimit([1],1,eachNoCallbackIterator.bind(this,e))},exports["eachLimit synchronous"]=function(e){var t=[],n=[0,1,2];async.eachLimit(n,5,function(e,n){t.push(e),n()},function(r){e.same(t,n),e.done()})},exports["forEachLimit alias"]=function(e){e.strictEqual(async.eachLimit,async.forEachLimit),e.done()},exports.map=function(e){var t=[];async.map([1,3,2],mapIterator.bind(this,t),function(n,r){e.same(t,[1,2,3]),e.same(r,[2,6,4]),e.done()})},exports["map original untouched"]=function(e){var t=[1,2,3];async.map(t,function(e,t){t(null,e*2)},function(n,r){e.same(r,[2,4,6]),e.same(t,[1,2,3]),e.done()})},exports["map error"]=function(e){e.expect(1),async.map([1,2,3],function(e,t){t("error")},function(t,n){e.equals(t,"error")}),setTimeout(e.done,50)},exports.mapSeries=function(e){var t=[];async.mapSeries([1,3,2],mapIterator.bind(this,t),function(n,r){e.same(t,[1,3,2]),e.same(r,[2,6,4]),e.done()})},exports["mapSeries error"]=function(e){e.expect(1),async.mapSeries([1,2,3],function(e,t){t("error")},function(t,n){e.equals(t,"error")}),setTimeout(e.done,50)},exports.mapLimit=function(e){var t=[];async.mapLimit([2,4,3],2,mapIterator.bind(this,t),function(n,r){e.same(t,[2,4,3]),e.same(r,[4,8,6]),e.done()})},exports["mapLimit empty array"]=function(e){e.expect(1),async.mapLimit([],2,function(t,n){e.ok(!1,"iterator should not be called"),n()},function(t){e.ok(!0,"should call callback")}),setTimeout(e.done,25)},exports["mapLimit limit exceeds size"]=function(e){var t=[];async.mapLimit([0,1,2,3,4,5,6,7,8,9],20,mapIterator.bind(this,t),function(n,r){e.same(t,[0,1,2,3,4,5,6,7,8,9]),e.same(r,[0,2,4,6,8,10,12,14,16,18]),e.done()})},exports["mapLimit limit equal size"]=function(e){var t=[];async.mapLimit([0,1,2,3,4,5,6,7,8,9],10,mapIterator.bind(this,t),function(n,r){e.same(t,[0,1,2,3,4,5,6,7,8,9]),e.same(r,[0,2,4,6,8,10,12,14,16,18]),e.done()})},exports["mapLimit zero limit"]=function(e){e.expect(2),async.mapLimit([0,1,2,3,4,5],0,function(t,n){e.ok(!1,"iterator should not be called"),n()},function(t,n){e.same(n,[]),e.ok(!0,"should call callback")}),setTimeout(e.done,25)},exports["mapLimit error"]=function(e){e.expect(2);var t=[0,1,2,3,4,5,6,7,8,9],n=[];async.mapLimit(t,3,function(e,t){n.push(e),e===2&&t("error")},function(t){e.same(n,[0,1,2]),e.equals(t,"error")}),setTimeout(e.done,25)},exports.reduce=function(e){var t=[];async.reduce([1,2,3],0,function(e,n,r){t.push(n),r(null,e+n)},function(n,r){e.equals(r,6),e.same(t,[1,2,3]),e.done()})},exports["reduce async with non-reference memo"]=function(e){async.reduce([1,3,2],0,function(e,t,n){setTimeout(function(){n(null,e+t)},Math.random()*100)},function(t,n){e.equals(n,6),e.done()})},exports["reduce error"]=function(e){e.expect(1),async.reduce([1,2,3],0,function(e,t,n){n("error")},function(t,n){e.equals(t,"error")}),setTimeout(e.done,50)},exports["inject alias"]=function(e){e.equals(async.inject,async.reduce),e.done()},exports["foldl alias"]=function(e){e.equals(async.foldl,async.reduce),e.done()},exports.reduceRight=function(e){var t=[],n=[1,2,3];async.reduceRight(n,0,function(e,n,r){t.push(n),r(null,e+n)},function(r,i){e.equals(i,6),e.same(t,[3,2,1]),e.same(n,[1,2,3]),e.done()})},exports["foldr alias"]=function(e){e.equals(async.foldr,async.reduceRight),e.done()},exports.filter=function(e){async.filter([3,1,2],filterIterator,function(t){e.same(t,[3,1]),e.done()})},exports["filter original untouched"]=function(e){var t=[3,1,2];async.filter(t,function(e,t){t(e%2)},function(n){e.same(n,[3,1]),e.same(t,[3,1,2]),e.done()})},exports.filterSeries=function(e){async.filterSeries([3,1,2],filterIterator,function(t){e.same(t,[3,1]),e.done()})},exports["select alias"]=function(e){e.equals(async.select,async.filter),e.done()},exports["selectSeries alias"]=function(e){e.equals(async.selectSeries,async.filterSeries),e.done()},exports.reject=function(e){async.reject([3,1,2],filterIterator,function(t){e.same(t,[2]),e.done()})},exports["reject original untouched"]=function(e){var t=[3,1,2];async.reject(t,function(e,t){t(e%2)},function(n){e.same(n,[2]),e.same(t,[3,1,2]),e.done()})},exports.rejectSeries=function(e){async.rejectSeries([3,1,2],filterIterator,function(t){e.same(t,[2]),e.done()})},exports["some true"]=function(e){async.some([3,1,2],function(e,t){setTimeout(function(){t(e===1)},0)},function(t){e.equals(t,!0),e.done()})},exports["some false"]=function(e){async.some([3,1,2],function(e,t){setTimeout(function(){t(e===10)},0)},function(t){e.equals(t,!1),e.done()})},exports["some early return"]=function(e){var t=[];async.some([1,2,3],function(e,n){setTimeout(function(){t.push(e),n(e===1)},e*25)},function(e){t.push("callback")}),setTimeout(function(){e.same(t,[1,"callback",2,3]),e.done()},100)},exports["any alias"]=function(e){e.equals(async.any,async.some),e.done()},exports["every true"]=function(e){async.every([1,2,3],function(e,t){setTimeout(function(){t(!0)},0)},function(t){e.equals(t,!0),e.done()})},exports["every false"]=function(e){async.every([1,2,3],function(e,t){setTimeout(function(){t(e%2)},0)},function(t){e.equals(t,!1),e.done()})},exports["every early return"]=function(e){var t=[];async.every([1,2,3],function(e,n){setTimeout(function(){t.push(e),n(e===1)},e*25)},function(e){t.push("callback")}),setTimeout(function(){e.same(t,[1,2,"callback",3]),e.done()},100)},exports["all alias"]=function(e){e.equals(async.all,async.every),e.done()},exports.detect=function(e){var t=[];async.detect([3,2,1],detectIterator.bind(this,t),function(n){t.push("callback"),e.equals(n,2)}),setTimeout(function(){e.same(t,[1,2,"callback",3]),e.done()},100)},exports["detect - mulitple matches"]=function(e){var t=[];async.detect([3,2,2,1,2],detectIterator.bind(this,t),function(n){t.push("callback"),e.equals(n,2)}),setTimeout(function(){e.same(t,[1,2,"callback",2,2,3]),e.done()},100)},exports.detectSeries=function(e){var t=[];async.detectSeries([3,2,1],detectIterator.bind(this,t),function(n){t.push("callback"),e.equals(n,2)}),setTimeout(function(){e.same(t,[3,2,"callback"]),e.done()},200)},exports["detectSeries - multiple matches"]=function(e){var t=[];async.detectSeries([3,2,2,1,2],detectIterator.bind(this,t),function(n){t.push("callback"),e.equals(n,2)}),setTimeout(function(){e.same(t,[3,2,"callback"]),e.done()},200)},exports.sortBy=function(e){async.sortBy([{a:1},{a:15},{a:6}],function(e,t){setTimeout(function(){t(null,e.a)},0)},function(t,n){e.same(n,[{a:1},{a:6},{a:15}]),e.done()})},exports.apply=function(e){e.expect(6);var t=function(){e.same(Array.prototype.slice.call(arguments),[1,2,3,4])};async.apply(t,1,2,3,4)(),async.apply(t,1,2,3)(4),async.apply(t,1,2)(3,4),async.apply(t,1)(2,3,4),async.apply(t)(1,2,3,4),e.equals(async.apply(function(e){return"hello "+e},"world")(),"hello world"),e.done()};var console_fn_tests=function(e){typeof console!="undefined"&&(exports[e]=function(t){t.expect(5);var n=function(e,n){t.equals(e,"one"),setTimeout(function(){n(null,"test")},0)},r=function(e,n){t.equals(e,"one"),setTimeout(function(){n("error")},0)},i=console[e],s=console.error;console[e]=function(n){t.equals(n,"test"),t.equals(arguments.length,1),console.error=function(n){t.equals(n,"error"),console[e]=i,console.error=s,t.done()},async[e](r,"one")},async[e](n,"one")},exports[e+" with multiple result params"]=function(t){var n=function(e){e(null,"one","two","three")},r=console[e],i=[];console[e]=function(e){i.push(e)},async[e](n),t.same(i,["one","two","three"]),console[e]=r,t.done()}),exports[e+" without console."+e]=function(t){if(typeof window!="undefined"){var n=window.console;window.console=undefined;var r=function(e){e(null,"val")},i=function(e){e("error")};async[e](r),async[e](i),window.console=n}t.done()}};exports.times=function(e){var t=[];async.times(5,function(e,t){t(null,e)},function(t,n){e.same(n,[0,1,2,3,4]),e.done()})},exports.times=function(e){var t=[];async.times(3,function(e,n){setTimeout(function(){t.push(e),n()},e*25)},function(n){e.same(t,[0,1,2]),e.done()})},exports["times 0"]=function(e){e.expect(1),async.times(0,function(t,n){e.ok(!1,"iterator should not be called"),n()},function(t){e.ok(!0,"should call callback")}),setTimeout(e.done,25)},exports["times error"]=function(e){e.expect(1),async.times(3,function(e,t){t("error")},function(t){e.equals(t,"error")}),setTimeout(e.done,50)},exports.timesSeries=function(e){var t=[];async.timesSeries(5,function(e,n){setTimeout(function(){t.push(e),n(null,e)},100-e*10)},function(n,r){e.same(t,[0,1,2,3,4]),e.same(r,[0,1,2,3,4]),e.done()})},exports["timesSeries error"]=function(e){e.expect(1),async.timesSeries(5,function(e,t){t("error")},function(t,n){e.equals(t,"error")}),setTimeout(e.done,50)},console_fn_tests("log"),console_fn_tests("dir"),exports.nextTick=function(e){var t=[];async.nextTick(function(){t.push("two")}),t.push("one"),setTimeout(function(){e.same(t,["one","two"]),e.done()},50)},exports["nextTick in the browser"]=function(e){if(typeof process!="undefined")return e.done();e.expect(1);var t=[];async.nextTick(function(){t.push("two")}),t.push("one"),setTimeout(function(){typeof process!="undefined"&&(process.nextTick=_nextTick),e.same(t,["one","two"])},50),setTimeout(e.done,100)},exports["noConflict - node only"]=function(e){if(typeof process!="undefined"){e.expect(3);var t=require("fs"),n=__dirname+"/../lib/async.js";t.readFile(n,function(t,r){if(t)return e.done();var i=process.binding("evals").Script||process.binding("evals").NodeScript,s=new i(r,n),o=new i(r+"this.async2 = this.async.noConflict();",n),u={async:"oldvalue"};s.runInNewContext(u),e.ok(u.async);var a={async:"oldvalue"};o.runInNewContext(a),e.equals(a.async,"oldvalue"),e.ok(a.async2),e.done()})}else e.done()},exports.concat=function(e){var t=[],n=function(e,n){setTimeout(function(){t.push(e);var r=[];while(e>0)r.push(e),e--;n(null,r)},e*25)};async.concat([1,3,2],n,function(n,r){e.same(r,[1,2,1,3,2,1]),e.same(t,[1,2,3]),e.ok(!n),e.done()})},exports["concat error"]=function(e){var t=function(e,t){t(new Error("test error"))};async.concat([1,2,3],t,function(t,n){e.ok(t),e.done()})},exports.concatSeries=function(e){var t=[],n=function(e,n){setTimeout(function(){t.push(e);var r=[];while(e>0)r.push(e),e--;n(null,r)},e*25)};async.concatSeries([1,3,2],n,function(n,r){e.same(r,[1,3,2,1,2,1]),e.same(t,[1,3,2]),e.ok(!n),e.done()})},exports.until=function(e){var t=[],n=0;async.until(function(){return t.push(["test",n]),n==5},function(e){t.push(["iterator",n]),n++,e()},function(r){e.same(t,[["test",0],["iterator",0],["test",1],["iterator",1],["test",2],["iterator",2],["test",3],["iterator",3],["test",4],["iterator",4],["test",5]]),e.equals(n,5),e.done()})},exports.doUntil=function(e){var t=[],n=0;async.doUntil(function(e){debugger;t.push(["iterator",n]),n++,e()},function(){return t.push(["test",n]),n==5},function(r){e.same(t,[["iterator",0],["test",1],["iterator",1],["test",2],["iterator",2],["test",3],["iterator",3],["test",4],["iterator",4],["test",5]]),e.equals(n,5),e.done()})},exports.whilst=function(e){var t=[],n=0;async.whilst(function(){return t.push(["test",n]),n<5},function(e){t.push(["iterator",n]),n++,e()},function(r){e.same(t,[["test",0],["iterator",0],["test",1],["iterator",1],["test",2],["iterator",2],["test",3],["iterator",3],["test",4],["iterator",4],["test",5]]),e.equals(n,5),e.done()})},exports.doWhilst=function(e){var t=[],n=0;async.doWhilst(function(e){t.push(["iterator",n]),n++,e()},function(){return t.push(["test",n]),n<5},function(r){debugger;e.same(t,[["iterator",0],["test",1],["iterator",1],["test",2],["iterator",2],["test",3],["iterator",3],["test",4],["iterator",4],["test",5]]),e.equals(n,5),e.done()})},exports.queue=function(e){var t=[],n=[160,80,240,80],r=async.queue(function(e,r){setTimeout(function(){t.push("process "+e),r("error","arg")},n.splice(0,1)[0])},2);r.push(1,function(n,i){e.equal(n,"error"),e.equal(i,"arg"),e.equal(r.length(),1),t.push("callback 1")}),r.push(2,function(n,i){e.equal(n,"error"),e.equal(i,"arg"),e.equal(r.length(),2),t.push("callback 2")}),r.push(3,function(n,i){e.equal(n,"error"),e.equal(i,"arg"),e.equal(r.length(),0),t.push("callback 3")}),r.push(4,function(n,i){e.equal(n,"error"),e.equal(i,"arg"),e.equal(r.length(),0),t.push("callback 4")}),e.equal(r.length(),4),e.equal(r.concurrency,2),r.drain=function(){e.same(t,["process 2","callback 2","process 1","callback 1","process 4","callback 4","process 3","callback 3"]),e.equal(r.concurrency,2),e.equal(r.length(),0),e.done()}},exports["queue error propagation"]=function(e){var t=[],n=async.queue(function(e,t){t(e.name==="foo"?new Error("fooError"):null)},2);n.drain=function(){e.deepEqual(t,["bar","fooError"]),e.done()},n.push({name:"bar"},function(e){if(e){t.push("barError");return}t.push("bar")}),n.push({name:"foo"},function(e){if(e){t.push("fooError");return}t.push("foo")})},exports["queue changing concurrency"]=function(e){var t=[],n=[40,20,60,20],r=async.queue(function(e,r){setTimeout(function(){t.push("process "+e),r("error","arg")},n.splice(0,1)[0])},2);r.push(1,function(n,i){e.equal(n,"error"),e.equal(i,"arg"),e.equal(r.length(),3),t.push("callback 1")}),r.push(2,function(n,i){e.equal(n,"error"),e.equal(i,"arg"),e.equal(r.length(),2),t.push("callback 2")}),r.push(3,function(n,i){e.equal(n,"error"),e.equal(i,"arg"),e.equal(r.length(),1),t.push("callback 3")}),r.push(4,function(n,i){e.equal(n,"error"),e.equal(i,"arg"),e.equal(r.length(),0),t.push("callback 4")}),e.equal(r.length(),4),e.equal(r.concurrency,2),r.concurrency=1,setTimeout(function(){e.same(t,["process 1","callback 1","process 2","callback 2","process 3","callback 3","process 4","callback 4"]),e.equal(r.concurrency,1),e.equal(r.length(),0),e.done()},250)},exports["queue push without callback"]=function(e){var t=[],n=[160,80,240,80],r=async.queue(function(e,r){setTimeout(function(){t.push("process "+e),r("error","arg")},n.splice(0,1)[0])},2);r.push(1),r.push(2),r.push(3),r.push(4),setTimeout(function(){e.same(t,["process 2","process 1","process 4","process 3"]),e.done()},800)},exports["queue unshift"]=function(e){var t=[],n=async.queue(function(e,n){t.push(e),n()},1);n.unshift(4),n.unshift(3),n.unshift(2),n.unshift(1),setTimeout(function(){e.same(t,[1,2,3,4]),e.done()},100)},exports["queue too many callbacks"]=function(e){var t=async.queue(function(t,n){n(),e.throws(function(){n()}),e.done()},2);t.push(1)},exports["queue bulk task"]=function(e){var t=[],n=[160,80,240,80],r=async.queue(function(e,r){setTimeout(function(){t.push("process "+e),r("error",e)},n.splice(0,1)[0])},2);r.push([1,2,3,4],function(n,r){e.equal(n,"error"),t.push("callback "+r)}),e.equal(r.length(),4),e.equal(r.concurrency,2),setTimeout(function(){e.same(t,["process 2","callback 2","process 1","callback 1","process 4","callback 4","process 3","callback 3"]),e.equal(r.concurrency,2),e.equal(r.length(),0),e.done()},800)},exports.cargo=function(e){var t=[],n=[160,160,80],r=async.cargo(function(e,r){setTimeout(function(){t.push("process "+e.join(" ")),r("error","arg")},n.shift())},2);r.push(1,function(n,i){e.equal(n,"error"),e.equal(i,"arg"),e.equal(r.length(),3),t.push("callback 1")}),r.push(2,function(n,i){e.equal(n,"error"),e.equal(i,"arg"),e.equal(r.length(),3),t.push("callback 2")}),e.equal(r.length(),2),setTimeout(function(){r.push(3,function(n,i){e.equal(n,"error"),e.equal(i,"arg"),e.equal(r.length(),1),t.push("callback 3")})},60),setTimeout(function(){r.push(4,function(n,i){e.equal(n,"error"),e.equal(i,"arg"),e.equal(r.length(),1),t.push("callback 4")}),e.equal(r.length(),2),r.push(5,function(n,i){e.equal(n,"error"),e.equal(i,"arg"),e.equal(r.length(),0),t.push("callback 5")})},120),setTimeout(function(){e.same(t,["process 1 2","callback 1","callback 2","process 3 4","callback 3","callback 4","process 5","callback 5"]),e.equal(r.length(),0),e.done()},800)},exports["cargo without callback"]=function(e){var t=[],n=[160,80,240,80],r=async.cargo(function(e,r){setTimeout(function(){t.push("process "+e.join(" ")),r("error","arg")},n.shift())},2);r.push(1),setTimeout(function(){r.push(2)},120),setTimeout(function(){r.push(3),r.push(4),r.push(5)},180),setTimeout(function(){e.same(t,["process 1","process 2","process 3 4","process 5"]),e.done()},800)},exports["cargo bulk task"]=function(e){var t=[],n=[120,40],r=async.cargo(function(e,r){setTimeout(function(){t.push("process "+e.join(" ")),r("error",e.join(" "))},n.shift())},3);r.push([1,2,3,4],function(n,r){e.equal(n,"error"),t.push("callback "+r)}),e.equal(r.length(),4),setTimeout(function(){e.same(t,["process 1 2 3","callback 1 2 3","callback 1 2 3","callback 1 2 3","process 4","callback 4"]),e.equal(r.length(),0),e.done()},800)},exports.memoize=function(e){e.expect(4);var t=[],n=function(e,n,r){t.push(["fn",e,n]),r(null,e+n)},r=async.memoize(n);r(1,2,function(t,n){e.equal(n,3)}),r(1,2,function(t,n){e.equal(n,3)}),r(2,2,function(t,n){e.equal(n,4)}),e.same(t,[["fn",1,2],["fn",2,2]]),e.done()},exports.unmemoize=function(e){e.expect(4);var t=[],n=function(e,n,r){t.push(["fn",e,n]),r(null,e+n)},r=async.memoize(n),i=async.unmemoize(r);i(1,2,function(t,n){e.equal(n,3)}),i(1,2,function(t,n){e.equal(n,3)}),i(2,2,function(t,n){e.equal(n,4)}),e.same(t,[["fn",1,2],["fn",1,2],["fn",2,2]]),e.done()},exports["unmemoize a not memoized function"]=function(e){e.expect(1);var t=function(e,t,n){n(null,e+t)},n=async.unmemoize(t);n(1,2,function(t,n){e.equal(n,3)}),e.done()},exports["memoize error"]=function(e){e.expect(1);var t=new Error("test"),n=function(e,n,r){r(t,e+n)};async.memoize(n)(1,2,function(n,r){e.equal(n,t)}),e.done()},exports["memoize multiple calls"]=function(e){e.expect(3);var t=function(t,n,r){e.ok(!0),setTimeout(function(){r(null,t,n)},10)},n=async.memoize(t);n(1,2,function(t,n){e.equal(n,1,2)}),n(1,2,function(t,n){e.equal(n,1,2),e.done()})},exports["memoize custom hash function"]=function(e){e.expect(2);var t=new Error("test"),n=function(e,n,r){r(t,e+n)},r=async.memoize(n,function(){return"custom hash"});r(1,2,function(t,n){e.equal(n,3)}),r(2,2,function(t,n){e.equal(n,3)}),e.done()},exports["memoize manually added memo value"]=function(e){e.expect(1);var t=async.memoize(function(t,n){e(!1,"Function should never be called")});t.memo.foo=["bar"],t("foo",function(t){e.equal(t,"bar"),e.done()})},exports["falsy return values in series"]=function(e){function t(e){async.nextTick(function(){e(null,!1)})}function n(e){async.nextTick(function(){e(null,undefined)})}function r(e){async.nextTick(function(){e(null)})}function i(e){async.nextTick(function(){e(null,null)})}async.series([t,n,r,i],function(t,n){e.equal(n.length,4),e.strictEqual(n[0],!1),e.strictEqual(n[1],undefined),e.strictEqual(n[2],undefined),e.strictEqual(n[3],null),e.done()})},exports["falsy return values in parallel"]=function(e){function t(e){async.nextTick(function(){e(null,!1)})}function n(e){async.nextTick(function(){e(null,undefined)})}function r(e){async.nextTick(function(){e(null)})}function i(e){async.nextTick(function(){e(null,null)})}async.parallel([t,n,r,i],function(t,n){e.equal(n.length,4),e.strictEqual(n[0],!1),e.strictEqual(n[1],undefined),e.strictEqual(n[2],undefined),e.strictEqual(n[3],null),e.done()})},exports["queue events"]=function(e){var t=[],n=async.queue(function(e,n){t.push("process "+e),n()},3);n.saturated=function(){e.ok(n.length()==3,"queue should be saturated now"),t.push("saturated")},n.empty=function(){e.ok(n.length()==0,"queue should be empty now"),t.push("empty")},n.drain=function(){e.ok(n.length()==0&&n.running()==0,"queue should be empty now and no more workers should be running"),t.push("drain"),e.same(t,["saturated","process foo","process bar","process zoo","foo cb","process poo","bar cb","empty","process moo","zoo cb","poo cb","moo cb","drain"]),e.done()},n.push("foo",function(){t.push("foo cb")}),n.push("bar",function(){t.push("bar cb")}),n.push("zoo",function(){t.push("zoo cb")}),n.push("poo",function(){t.push("poo cb")}),n.push("moo",function(){t.push("moo cb")})},exports["avoid stack overflows for sync tasks"]=function(e){if(typeof window!="undefined")return e.done();var t=[],n=[];for(var r=0;r<1e4;r++)t.push[r],n.push(function(e){return e()});var i=function(e,t){t()},s=0,o=function(){return s<=1e4},i=function(e){s++,e()},u=function(){return s>1e4},a=function(e){s=0,e()};async.series([async.apply(async.each,t,i),async.apply(async.eachSeries,t,i),async.apply(async.eachLimit,t,i,2),async.apply(async.whilst,o,i),a,async.apply(async.until,u,i),a,async.apply(async.doWhilst,i,o),a,async.apply(async.doUntil,i,u),async.apply(async.series,n),async.apply(async.parallel,n),function(e){var t=async.queue(function(e,t){t()},2);for(var n=0;n<1e4;n++)t.push(n);t.drain=e}],function(t){e.done(t)})};