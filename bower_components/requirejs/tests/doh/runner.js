this.doh||(doh={}),doh.selfTest=!1,doh.global=this,doh.hitch=function(e,t){var n=[];for(var r=2;r<arguments.length;r++)n.push(arguments[r]);var i=(typeof t=="string"?e[t]:t)||function(){};return function(){var t=n.concat([]);for(var r=0;r<arguments.length;r++)t.push(arguments[r]);return i.apply(e,t)}},doh._mixin=function(e,t){var n={};for(var r in t)if(n[r]===undefined||n[r]!=t[r])e[r]=t[r];return this.document&&document.all&&typeof t["toString"]=="function"&&t["toString"]!=e["toString"]&&t["toString"]!=n["toString"]&&(e.toString=t.toString),e},doh.mixin=function(e,t){for(var n=1,r=arguments.length;n<r;n++)doh._mixin(e,arguments[n]);return e},doh.extend=function(e,t){for(var n=1,r=arguments.length;n<r;n++)doh._mixin(e.prototype,arguments[n]);return e},doh._line="------------------------------------------------------------",doh.debug=function(){},doh._AssertFailure=function(e,t){return this instanceof doh._AssertFailure?(t&&(e=new String(e||"")+" with hint: \n		"+(new String(t)+"\n")),this.message=new String(e||""),this):new doh._AssertFailure(e,t)},doh._AssertFailure.prototype=new Error,doh._AssertFailure.prototype.constructor=doh._AssertFailure,doh._AssertFailure.prototype.name="doh._AssertFailure",doh.Deferred=function(e){this.chain=[],this.id=this._nextId(),this.fired=-1,this.paused=0,this.results=[null,null],this.canceller=e,this.silentlyCancelled=!1},doh.extend(doh.Deferred,{getTestErrback:function(e,t){var n=this;return function(){try{e.apply(t||doh.global||n,arguments)}catch(r){n.errback(r)}}},getTestCallback:function(e,t){var n=this;return function(){try{e.apply(t||doh.global||n,arguments)}catch(r){n.errback(r);return}n.callback(!0)}},getFunctionFromArgs:function(){var e=arguments;if(e[0]&&!e[1]){if(typeof e[0]=="function")return e[0];if(typeof e[0]=="string")return doh.global[e[0]]}else if(e[0]&&e[1])return doh.hitch(e[0],e[1]);return null},makeCalled:function(){var e=new doh.Deferred;return e.callback(),e},_nextId:function(){var e=1;return function(){return e++}}(),cancel:function(){this.fired==-1?(this.canceller?this.canceller(this):this.silentlyCancelled=!0,this.fired==-1&&this.errback(new Error("Deferred(unfired)"))):this.fired==0&&this.results[0]instanceof doh.Deferred&&this.results[0].cancel()},_pause:function(){this.paused++},_unpause:function(){this.paused--,this.paused==0&&this.fired>=0&&this._fire()},_continue:function(e){this._resback(e),this._unpause()},_resback:function(e){this.fired=e instanceof Error?1:0,this.results[this.fired]=e,this._fire()},_check:function(){if(this.fired!=-1){if(!this.silentlyCancelled)throw new Error("already called!");this.silentlyCancelled=!1;return}},callback:function(e){this._check(),this._resback(e)},errback:function(e){this._check(),e instanceof Error||(e=new Error(e)),this._resback(e)},addBoth:function(e,t){var n=this.getFunctionFromArgs(e,t);return arguments.length>2&&(n=doh.hitch(null,n,arguments,2)),this.addCallbacks(n,n)},addCallback:function(e,t){var n=this.getFunctionFromArgs(e,t);return arguments.length>2&&(n=doh.hitch(null,n,arguments,2)),this.addCallbacks(n,null)},addErrback:function(e,t){var n=this.getFunctionFromArgs(e,t);return arguments.length>2&&(n=doh.hitch(null,n,arguments,2)),this.addCallbacks(null,n)},addCallbacks:function(e,t){return this.chain.push([e,t]),this.fired>=0&&this._fire(),this},_fire:function(){var e=this.chain,t=this.fired,n=this.results[t],r=this,i=null;while(e.length>0&&this.paused==0){var s=e.shift(),o=s[t];if(o==null)continue;try{n=o(n),t=n instanceof Error?1:0,n instanceof doh.Deferred&&(i=function(e){r._continue(e)},this._pause())}catch(u){t=1,n=u}}this.fired=t,this.results[t]=n,i&&this.paused&&n.addBoth(i)}}),doh._testCount=0,doh._groupCount=0,doh._errorCount=0,doh._failureCount=0,doh._currentGroup=null,doh._currentTest=null,doh._paused=!0,doh._init=function(){this._currentGroup=null,this._currentTest=null,this._errorCount=0,this._failureCount=0,this.debug(this._testCount,"tests to run in",this._groupCount,"groups")},doh._groups={},doh.registerTestNs=function(e,t){for(var n in t)n.charAt(0)!="_"&&typeof t[n]=="function"&&this.registerTest(e,t[n])},doh._testRegistered=function(e,t){},doh._groupStarted=function(e){},doh._groupFinished=function(e,t){},doh._testStarted=function(e,t){},doh._testFinished=function(e,t,n){},doh.registerGroup=function(e,t,n,r,i){t&&this.register(e,t,i),n&&(this._groups[e].setUp=n),r&&(this._groups[e].tearDown=r)},doh._getTestObj=function(e,t,n){var r=t;if(typeof t=="string"){if(t.substr(0,4)=="url:")return this.registerUrl(e,t);r={name:t.replace("/s/g","_")},r.runTest=new Function("t",t)}else if(typeof t=="function"){r={runTest:t};if(t.name)r.name=t.name;else try{var i="function ",s=r.runTest+"";0<=s.indexOf(i)&&(r.name=s.split(i)[1].split("(",1)[0])}catch(o){}}if(n==="perf"||r.testType==="perf")r.testType="perf",doh.perfTestResults||(doh.perfTestResults={},doh.perfTestResults[e]={}),doh.perfTestResults[e]||(doh.perfTestResults[e]={}),doh.perfTestResults[e][r.name]||(doh.perfTestResults[e][r.name]={}),r.results=doh.perfTestResults[e][r.name],"trialDuration"in r||(r.trialDuration=100),"trialDelay"in r||(r.trialDelay=100),"trialIterations"in r||(r.trialIterations=10);return r},doh.registerTest=function(e,t,n){this._groups[e]||(this._groupCount++,this._groups[e]=[],this._groups[e].inFlight=0);var r=this._getTestObj(e,t,n);return r?(this._groups[e].push(r),this._testCount++,this._testRegistered(e,r),r):null},doh.registerTests=function(e,t,n){for(var r=0;r<t.length;r++)this.registerTest(e,t[r],n)},doh.registerUrl=function(e,t,n,r){this.debug("ERROR:"),this.debug("	NO registerUrl() METHOD AVAILABLE.")},doh.registerString=function(e,t,n){},doh.register=doh.add=function(e,t,n){arguments.length==1&&typeof e=="string"&&(e.substr(0,4)=="url:"?this.registerUrl(e,null,null,n):this.registerTest("ungrouped",e,n));if(arguments.length==1){this.debug("invalid args passed to doh.register():",e,",",t);return}if(typeof t=="string"){t.substr(0,4)=="url:"?this.registerUrl(t,null,null,n):this.registerTest(e,t,n);return}if(doh._isArray(t)){this.registerTests(e,t,n);return}this.registerTest(e,t,n)},doh.registerDocTests=function(e){this.debug("registerDocTests() requires dojo to be loaded into the environment. Skipping doctest set for module:",e)},function(){if(typeof dojo!="undefined"){try{dojo.require("dojox.testing.DocTest")}catch(e){console.debug(e),doh.registerDocTests=function(){};return}doh.registerDocTests=function(e){var t=new dojox.testing.DocTest,n=t.getTests(e),r=n.length,i=[];for(var s=0;s<r;s++){var o=n[s],u="";if(o.commands.length&&o.commands[0].indexOf("//")!=-1){var a=o.commands[0].split("//");u=", "+a[a.length-1]}i.push({runTest:function(e){return function(n){var r=t.runTest(e.commands,e.expectedResult);n.assertTrue(r.success)}}(o),name:"Line "+o.line+u})}this.register("DocTests: "+e,i)}}}(),doh.t=doh.assertTrue=function(condition,hint){if(arguments.length<1)throw new doh._AssertFailure("assertTrue failed because it was not passed at least 1 argument");if(!eval(condition))throw new doh._AssertFailure("assertTrue('"+condition+"') failed",hint)},doh.f=doh.assertFalse=function(condition,hint){if(arguments.length<1)throw new doh._AssertFailure("assertFalse failed because it was not passed at least 1 argument");if(eval(condition))throw new doh._AssertFailure("assertFalse('"+condition+"') failed",hint)},doh.e=doh.assertError=function(e,t,n,r,i){try{t[n].apply(t,r)}catch(s){if(s instanceof e)return!0;throw new doh._AssertFailure("assertError() failed:\n	expected error\n		"+e+"\n	but got\n		"+s+"\n\n",i)}throw new doh._AssertFailure("assertError() failed:\n	expected error\n		"+e+"\n	but no error caught\n\n",i)},doh.is=doh.assertEqual=function(e,t,n){if(e===undefined&&t===undefined)return!0;if(arguments.length<2)throw doh._AssertFailure("assertEqual failed because it was not passed 2 arguments");if(e===t||e==t||typeof e=="number"&&typeof t=="number"&&isNaN(e)&&isNaN(t))return!0;if(this._isArray(e)&&this._isArray(t)&&this._arrayEq(e,t))return!0;if(typeof e=="object"&&typeof t=="object"&&this._objPropEq(e,t))return!0;throw new doh._AssertFailure("assertEqual() failed:\n	expected\n		"+e+"\n	but got\n		"+t+"\n\n",n)},doh.isNot=doh.assertNotEqual=function(e,t,n){if(e===undefined&&t===undefined)throw new doh._AssertFailure("assertNotEqual() failed: not expected |"+e+"| but got |"+t+"|",n);if(arguments.length<2)throw doh._AssertFailure("assertEqual failed because it was not passed 2 arguments");if(e===t||e==t)throw new doh._AssertFailure("assertNotEqual() failed: not expected |"+e+"| but got |"+t+"|",n);if(this._isArray(e)&&this._isArray(t)&&this._arrayEq(e,t))throw new doh._AssertFailure("assertNotEqual() failed: not expected |"+e+"| but got |"+t+"|",n);if(typeof e=="object"&&typeof t=="object"&&this._objPropEq(e,t))throw new doh._AssertFailure("assertNotEqual() failed: not expected |"+e+"| but got |"+t+"|",n);return!0},doh._arrayEq=function(e,t){if(e.length!=t.length)return!1;for(var n=0;n<e.length;n++)if(!doh.assertEqual(e[n],t[n]))return!1;return!0},doh._objPropEq=function(e,t){if(e===null&&t===null)return!0;if(e===null||t===null)return!1;if(e instanceof Date)return t instanceof Date&&e.getTime()==t.getTime();var n;for(n in t)if(e[n]===undefined)return!1;for(n in e)if(!doh.assertEqual(e[n],t[n]))return!1;return!0},doh._isArray=function(e){return e&&e instanceof Array||typeof e=="array"||!!doh.global.dojo&&doh.global.dojo.NodeList!==undefined&&e instanceof doh.global.dojo.NodeList},doh._setupGroupForRun=function(e,t){var n=this._groups[e];this.debug(this._line),this.debug("GROUP",'"'+e+'"',"has",n.length,"test"+(n.length>1?"s":"")+" to run")},doh._handleFailure=function(e,t,n){this._groups[e].failures++;var r="";n instanceof this._AssertFailure?(this._failureCount++,n.fileName&&(r+=n.fileName+":"),n.lineNumber&&(r+=n.lineNumber+" "),r+=n+": "+n.message,this.debug("	_AssertFailure:",r)):this._errorCount++,this.debug(n);if(t.runTest.toSource){var i=t.runTest.toSource();this.debug("	ERROR IN:\n		",i)}else this.debug("	ERROR IN:\n		",t.runTest);n.rhinoException?n.rhinoException.printStackTrace():n.javaException&&n.javaException.printStackTrace()},doh.setTimeout=function(e){return e()},doh._runPerfFixture=function(e,t){var n=this._groups[e];t.startTime=new Date;var r=new doh.Deferred;n.inFlight++,r.groupName=e,r.fixture=t,r.addErrback(function(n){doh._handleFailure(e,t,n)});var i=function(){t.tearDown&&t.tearDown(doh),n.inFlight--,!n.inFlight&&n.iterated&&doh._groupFinished(e,!n.failures),doh._testFinished(e,t,r.results[0]),doh._paused&&doh.run()},s,o=t.timeout;o>0&&(s=doh.setTimeout(function(){r.errback(new Error("test timeout in "+t.name.toString()))},o)),r.addBoth(function(e){s&&clearTimeout(s),i()});var u=t.results;u.trials=[];var a=doh._calcTrialIterations(e,t);return a.addErrback(function(e){t.endTime=new Date,r.errback(e)}),a.addCallback(function(n){if(n){var i=t.trialIterations;doh.debug("TIMING TEST: ["+t.name+"]\n		ITERATIONS PER TRIAL: "+n+"\n	TRIALS: "+i);var s=function(){var o=new Date,a=new doh.Deferred,f=n,l={countdown:n},c=function(n){while(n)try{n.countdown--;if(n.countdown){var i=t.runTest(doh);if(i instanceof doh.Deferred){var s={countdown:n.countdown};i.addCallback(function(){c(s)}),i.addErrback(function(n){doh._handleFailure(e,t,n),t.endTime=new Date,r.errback(n)}),n=null}}else a.callback(new Date),n=null}catch(o){t.endTime=new Date,a.errback(o)}};a.addCallback(function(e){var a={trial:t.trialIterations-i,testIterations:n,executionTime:e.getTime()-o.getTime(),average:(e.getTime()-o.getTime())/n};u.trials.push(a),doh.debug("\n		TRIAL #: "+a.trial+"\n	TIME: "+a.executionTime+"ms.\n	AVG TEST TIME: "+a.executionTime/a.testIterations+"ms."),i--;if(i)doh.setTimeout(s,t.trialDelay);else{var f=u.trials;t.endTime=new Date,r.callback(!0)}}),a.addErrback(function(e){t.endTime=new Date,r.errback(e)}),c(l)};s()}}),r.fired<0&&doh.pause(),r},doh._calcTrialIterations=function(e,t){var n=new doh.Deferred,r=function(){var e=t.runTest,r={start:new Date,curIter:0,iterations:5},i=function(r){while(r)if(r.curIter<r.iterations)try{var s=e(doh);if(s instanceof doh.Deferred){var o={start:r.start,curIter:r.curIter+1,iterations:r.iterations};s.addCallback(function(){i(o)}),s.addErrback(function(e){t.endTime=new Date,n.errback(e)}),r=null}else r.curIter++}catch(u){t.endTime=new Date,n.errback(u);return}else{var a=new Date,f=a.getTime()-r.start.getTime();if(f<t.trialDuration){var l={iterations:r.iterations*2,curIter:0};r=null,doh.setTimeout(function(){l.start=new Date,i(l)},50)}else{var c=r.iterations;doh.setTimeout(function(){n.callback(c)},50),r=null}}};i(r)};return doh.setTimeout(r,10),n},doh._runRegFixture=function(e,t){var n=this._groups[e];t.startTime=new Date;var r=t.runTest(this);t.endTime=new Date;if(r instanceof doh.Deferred){n.inFlight++,r.groupName=e,r.fixture=t,r.addErrback(function(n){doh._handleFailure(e,t,n)});var i=function(){t.tearDown&&t.tearDown(doh),n.inFlight--,!n.inFlight&&n.iterated&&doh._groupFinished(e,!n.failures),doh._testFinished(e,t,r.results[0]),doh._paused&&doh.run()},s=doh.setTimeout(function(){r.errback(new Error("test timeout in "+t.name.toString()))},t.timeout||1e3);return r.addBoth(function(e){clearTimeout(s),i()}),r.fired<0&&doh.pause(),r}},doh._runFixture=function(e,t){var n=this._groups[e];this._testStarted(e,t);var r=!1,i=null;try{t.group=n,t.setUp&&t.setUp(this);if(t.runTest){if(t.testType==="perf")return doh._runPerfFixture(e,t);var s=doh._runRegFixture(e,t);if(s)return s}t.tearDown&&t.tearDown(this)}catch(o){r=!0,i=o,t.endTime||(t.endTime=new Date)}var u=new doh.Deferred;return doh.setTimeout(this.hitch(this,function(){r&&this._handleFailure(e,t,i),this._testFinished(e,t,!r),!n.inFlight&&n.iterated?doh._groupFinished(e,!n.failures):n.inFlight>0&&(doh.setTimeout(this.hitch(this,function(){doh.runGroup(e)}),100),this._paused=!0),doh._paused&&doh.run()}),30),doh.pause(),u},doh._testId=0,doh.runGroup=function(e,t){var n=this._groups[e];if(n.skip===!0)return;if(this._isArray(n)){if(t<=n.length&&!n.inFlight&&n.iterated==1){n.tearDown&&n.tearDown(this),doh._groupFinished(e,!n.failures);return}t||(n.inFlight=0,n.iterated=!1,n.failures=0),doh._groupStarted(e),t||(this._setupGroupForRun(e,t),n.setUp&&n.setUp(this));for(var r=t||0;r<n.length;r++){if(this._paused){this._currentTest=r;return}doh._runFixture(e,n[r]);if(this._paused){this._currentTest=r+1,this._currentTest==n.length&&(n.iterated=!0);return}}n.iterated=!0,n.inFlight||(n.tearDown&&n.tearDown(this),doh._groupFinished(e,!n.failures))}},doh._onEnd=function(){},doh._report=function(){this.debug(this._line),this.debug("| TEST SUMMARY:"),this.debug(this._line),this.debug("	",this._testCount,"tests in",this._groupCount,"groups"),this.debug("	",this._errorCount,"errors"),this.debug("	",this._failureCount,"failures")},doh.togglePaused=function(){this[this._paused?"run":"pause"]()},doh.pause=function(){this._paused=!0},doh.run=function(){this._paused=!1;var e=this._currentGroup,t=this._currentTest,n=!1;e||(this._init(),n=!0),this._currentGroup=null,this._currentTest=null;for(var r in this._groups)if(!n&&r==e||n){if(this._paused)return;this._currentGroup=r,n?this.runGroup(r):(n=!0,this.runGroup(r,t));if(this._paused)return}this._currentGroup=null,this._currentTest=null,this._paused=!1,this._onEnd(),this._report()},doh.standardDeviation=function(e){return Math.sqrt(this.variance(e))},doh.variance=function(e){var t=0,n=0;return dojo.forEach(e,function(e){t+=e,n+=Math.pow(e,2)}),n/e.length-Math.pow(t/e.length,2)},doh.mean=function(e){var t=0;return dojo.forEach(e,function(e){t+=e}),t/Math.max(e.length,1)},doh.min=function(e){return Math.min.apply(null,e)},doh.max=function(e){return Math.max.apply(null,e)},doh.median=function(e){return e.slice(0).sort()[Math.ceil(e.length/2)-1]},doh.mode=function(e){var t={},n=0,r=Number.MIN_VALUE;dojo.forEach(e,function(e){t[e]!==undefined?t[e]++:t[e]=1});for(var i in t)r<t[i]&&(r=t[i],n=i);return n},doh.average=function(e){var t,n=0;for(t=0;t<e.length;t++)n+=e[t];return n/e.length},tests=doh,typeof skipDohSetup=="undefined"&&function(){var e;try{if(typeof dojo!="undefined"){dojo.platformRequire({browser:["doh._browserRunner"],rhino:["doh._rhinoRunner"],spidermonkey:["doh._rhinoRunner"]});try{var t=dojo.isBrowser?dojo.global==dojo.global["parent"]||!Boolean(dojo.global.parent.doh):!0}catch(n){t=!0}t&&dojo.isBrowser&&dojo.addOnLoad(function(){dojo.global.registerModulePath&&dojo.forEach(dojo.global.registerModulePath,function(e){dojo.registerModulePath(e[0],e[1])});if(dojo.byId("testList")){var e=dojo.global.testModule&&dojo.global.testModule.length?dojo.global.testModule:"dojo.tests.module";dojo.forEach(e.split(","),dojo.require,dojo),doh.setTimeout(function(){doh.run()},500)}})}else{if(typeof load=="function"&&(typeof Packages=="function"||typeof Packages=="object"))throw new Error;if(typeof load=="function")throw new Error;this.document}}catch(n){print("\n"+doh._line),print("The Dojo Unit Test Harness, $Rev: 20389 $"),print("Copyright (c) 2009, The Dojo Foundation, All Rights Reserved"),print(doh._line,"\n");try{var r="../../dojo/dojo.js",i="",s="dojo.tests.module",o="";for(e=0;e<arguments.length;e++)if(arguments[e].indexOf("=")>0){var u=arguments[e].split("=");u[0]=="dohBase"&&(o=u[1],o=o.replace(/\\/g,"/"),o.charAt(o.length-1)!="/"&&(o+="/")),u[0]=="dojoUrl"&&(r=u[1]),u[0]=="testUrl"&&(i=u[1]),u[0]=="testModule"&&(s=u[1])}load(o+"_rhinoRunner.js"),r.length&&(this.djConfig||(djConfig={}),djConfig.baseUrl=r.split("dojo.js")[0],load(r)),i.length&&load(i),s.length&&dojo.forEach(s.split(","),dojo.require,dojo)}catch(n){print("An exception occurred: "+n)}doh.run()}}.apply(this,typeof arguments!="undefined"?arguments:[null]);