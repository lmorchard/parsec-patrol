window.dojo&&dojo.provide("doh._browserRunner"),function(){doh.setTimeout=function(e,t){return setTimeout(e,t)};try{var topdog=window.parent==window||!Boolean(window.parent.doh)}catch(e){topdog=!0}if(topdog){var byId=function(e){return document.getElementById(e)},_addOnEvt=function(e,t,n){n||(n=window);var r=t;typeof t=="string"&&(r=n[t]);var i=function(){return r.apply(n,arguments)};window.dojo&&e=="load"?dojo.addOnLoad(i):window.attachEvent?window.attachEvent("on"+e,i):window.addEventListener?window.addEventListener(e,i,!1):document.addEventListener&&document.addEventListener(e,i,!1)},escapeXml=function(e){return e.replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/"/gm,"&quot;")},_logBacklog=[],_loggedMsgLen=0,sendToLogPane=function(e,t){var n="";for(var r=0;r<e.length;r++)n+=" "+e[r];n=escapeXml(n),n=n.replace("	","&nbsp;&nbsp;&nbsp;&nbsp;").replace(" ","&nbsp;").replace("\n","<br>&nbsp;");if(!byId("logBody")){_logBacklog.push(n);return}if(_logBacklog.length&&!t){var i;while(i=_logBacklog.shift())sendToLogPane(i,!0)}var s=byId("logBody"),o=document.createElement("div");o.innerHTML=n,s.appendChild(o),_loggedMsgLen++},findTarget=function(e){while(e&&!e.getAttribute("_target"))e=e.parentNode,e.getAttribute||(e=null);return e};doh._jumpToLog=function(e){var t=findTarget(e?e.target:window.event.srcElement);if(!t)return;var n=Number(t.getAttribute("_target")),r=byId("logBody");if(n>=r.childNodes.length)return;var i=r.childNodes[n];i.scrollIntoView();if(window.dojo){var s=dojo.style(i.parentNode.parentNode,"backgroundColor"),o=dojo.style(t.parentNode,"backgroundColor"),u=dojo.animateProperty({node:i,duration:500,properties:{backgroundColor:{start:o,end:s}},onEnd:function(){i.style.backgroundColor=""}}),a=dojo.animateProperty({node:i,duration:500,properties:{backgroundColor:{start:s,end:o}},onEnd:function(){u.play()}});a.play()}},doh._jumpToSuite=function(e){var t=findTarget(e?e.target:window.event.srcElement);if(!t)return;var n=t.getAttribute("_target"),r=getGroupNode(n);if(!r)return;r.scrollIntoView()},doh._init=function(e){return function(){var t=byId("logBody");if(t){while(t.firstChild)t.removeChild(t.firstChild);_loggedMsgLen=0}this._totalTime=0,this._suiteCount=0,e.apply(doh,arguments)}}(doh._init),doh._setupGroupForRun=function(e){return function(t){var n=doh._groups[t];doh._curTestCount=n.length,doh._curGroupCount=1;var r=getGroupNode(t);r&&r.getElementsByTagName("td")[2].setAttribute("_target",_loggedMsgLen+1),e.apply(doh,arguments)}}(doh._setupGroupForRun),doh._report=function(e){return function(){var t=byId("testList");if(t){var n=t.getElementsByTagName("tfoot");n.length&&t.removeChild(n[0]);var r=t.createTFoot(),i=r.insertRow(-1);i.className="inProgress";var s=i.insertCell(-1);s.colSpan=2,s.innerHTML="Result",s=i.insertCell(-1),s.innerHTML=this._testCount+" tests in "+this._groupCount+" groups /<span class='failure'>"+this._errorCount+"</span> errors, <span class='failure'>"+this._failureCount+"</span> failures",s.setAttribute("_target",_loggedMsgLen+1),i.insertCell(-1).innerHTML=doh._totalTime+"ms"}var o=null,u;if(doh.perfTestResults){window.dojo?(dojo.require("dojox.charting.Chart2D"),dojo.require("dojox.charting.DataChart"),dojo.require("dojox.charting.plot2d.Scatter"),dojo.require("dojox.charting.plot2d.Lines"),dojo.require("dojo.data.ItemFileReadStore"),o=doh._dojoPlotPerfResults):o=doh._asciiPlotPerfResults;try{var a,f=byId("perfTestsBody"),l=[];doh.perfTestResults&&doh.showPerfTestsPage();for(a in doh.perfTestResults){var c=doh.perfTestResults[a],h=document.createElement("h1");h.appendChild(document.createTextNode("Group: "+a)),f.appendChild(h);var p=document.createElement("blockquote");f.appendChild(p);var d;for(d in c){var v=c[d];if(!v)continue;var m=document.createElement("h3");m.appendChild(document.createTextNode("TEST: "+d)),m.style.textDecoration="underline",p.appendChild(m);var g=document.createElement("div");p.appendChild(g);var y="<b>TRIAL SIZE: </b>"+v.trials[0].testIterations+" iterations<br>"+"<b>NUMBER OF TRIALS: </b>"+v.trials.length+"<br>",b,w=[],E=[];for(b=0;b<v.trials.length;b++)w.push(v.trials[b].average),E.push(v.trials[b].executionTime);y+="<b>AVERAGE TRIAL EXECUTION TIME: </b>"+doh.average(E).toFixed(10)+"ms.<br>",y+="<b>MAXIMUM TEST ITERATION TIME: </b>"+doh.max(w).toFixed(10)+"ms.<br>",y+="<b>MINIMUM TEST ITERATION TIME: </b>"+doh.min(w).toFixed(10)+"ms.<br>",y+="<b>AVERAGE TEST ITERATION TIME: </b>"+doh.average(w).toFixed(10)+"ms.<br>",y+="<b>MEDIAN TEST ITERATION TIME: </b>"+doh.median(w).toFixed(10)+"ms.<br>",y+="<b>VARIANCE TEST ITERATION TIME: </b>"+doh.variance(w).toFixed(10)+"ms.<br>",y+="<b>STANDARD DEVIATION ON TEST ITERATION TIME: </b>"+doh.standardDeviation(w).toFixed(10)+"ms.<br>",g.innerHTML=y,g=document.createElement("div"),g.innerHTML="<h3>Average Test Execution Time (in milliseconds, with median line)</h3>",p.appendChild(g),g=document.createElement("div"),dojo.style(g,"width","600px"),dojo.style(g,"height","250px"),p.appendChild(g),l.push({div:g,title:"Average Test Execution Time",data:w}),g=document.createElement("div"),g.innerHTML="<h3>Average Trial Execution Time (in milliseconds, with median line)</h3>",p.appendChild(g),g=document.createElement("div"),dojo.style(g,"width","600px"),dojo.style(g,"height","250px"),p.appendChild(g),l.push({div:g,title:"Average Trial Execution Time",data:E})}}var S=function(){if(l.length){var e=l.shift();o(e.div,e.title,e.data)}doh.setTimeout(S,50)};doh.setTimeout(S,150)}catch(x){doh.debug(x)}}e.apply(doh,arguments)}}(doh._report),this.opera&&opera.postError?doh.debug=function(){var e="";for(var t=0;t<arguments.length;t++)e+=" "+arguments[t];sendToLogPane([e]),opera.postError("DEBUG:"+e)}:window.console?doh.debug=function(){var e="";for(var t=0;t<arguments.length;t++)e+=" "+arguments[t];sendToLogPane([e]),console.log("DEBUG:"+e)}:doh.debug=function(){sendToLogPane.call(window,arguments)};var loaded=!1,groupTemplate=null,testTemplate=null,groupNodes={},_groupTogglers={},_getGroupToggler=function(e,t){if(_groupTogglers[e])return _groupTogglers[e];var n=!0;return _groupTogglers[e]=function(r,i){var s=groupNodes[e].__items,o;if(n||i){n=!1;for(o=0;o<s.length;o++)s[o].style.display="";t.innerHTML="&#9660;"}else{n=!0;for(o=0;o<s.length;o++)s[o].style.display="none";t.innerHTML="&#9658;"}}},addGroupToList=function(e){if(!byId("testList"))return;var t=byId("testList").tBodies[0],n=groupTemplate.cloneNode(!0),r=n.getElementsByTagName("td"),i=r[0];i.onclick=_getGroupToggler(e,i);var s=r[1].getElementsByTagName("input")[0];return s.group=e,s.onclick=function(t){doh._groups[e].skip=!this.checked},r[2].innerHTML="<div class='testGroupName'>"+e+"</div><div style='width:0;'>&nbsp;</div>",r[3].innerHTML="",t.appendChild(n),n},addFixtureToList=function(e,t){if(!testTemplate)return;var n=groupNodes[e];n.__items||(n.__items=[]);var r=testTemplate.cloneNode(!0),i=r.getElementsByTagName("td");i[2].innerHTML=t.name,i[3].innerHTML="";var s=(n.__lastFixture||n.__groupNode).nextSibling;return s?s.parentNode.insertBefore(r,s):n.__groupNode.parentNode.appendChild(r),r.style.display="none",n.__items.push(r),n.__lastFixture=r},getFixtureNode=function(e,t){return groupNodes[e]?groupNodes[e][t.name]:null},getGroupNode=function(e){return groupNodes[e]?groupNodes[e].__groupNode:null},updateBacklog=[];doh._updateTestList=function(e,t,n){if(!loaded){e&&t&&updateBacklog.push([e,t]);return}if(updateBacklog.length&&!n){var r;while(r=updateBacklog.shift())doh._updateTestList(r[0],r[1],!0)}e&&t&&(groupNodes[e]||(groupNodes[e]={__groupNode:addGroupToList(e)}),groupNodes[e][t.name]||(groupNodes[e][t.name]=addFixtureToList(e,t)))},doh._testRegistered=doh._updateTestList,doh._groupStarted=function(e){this._suiteCount==0&&(this._runedSuite=0,this._currentGlobalProgressBarWidth=0,this._suiteCount=this._testCount),doh._inGroup!=e&&(doh._groupTotalTime=0,doh._runed=0,doh._inGroup=e,this._runedSuite++);var t=getGroupNode(e);t&&(t.className="inProgress")},doh._groupFinished=function(e,t){var n=getGroupNode(e);if(n&&doh._inGroup==e){doh._totalTime+=doh._groupTotalTime,n.getElementsByTagName("td")[3].innerHTML=doh._groupTotalTime+"ms",n.getElementsByTagName("td")[2].lastChild.className="",doh._inGroup=null;var r=doh._updateGlobalProgressBar(this._runedSuite/this._groupCount,t,e);n.className=r?"failure":"success",doh._currentGlobalProgressBarWidth=parseInt(this._runedSuite/this._groupCount*1e4)/100}doh._inGroup==e&&this.debug('Total time for GROUP "',e,'" is ',doh._groupTotalTime,"ms")},doh._testStarted=function(e,t){var n=getFixtureNode(e,t);n&&(n.className="inProgress")};var _nameTimes={},_playSound=function(e){if(byId("hiddenAudio")&&byId("audio")&&byId("audio").checked){var t=_nameTimes[e];if(!t||new Date-t>700){_nameTimes[e]=new Date;var n=document.createElement("span");byId("hiddenAudio").appendChild(n),n.innerHTML='<embed src="_sounds/'+e+'.wav" autostart="true" loop="false" hidden="true" width="1" height="1"></embed>'}}};doh._updateGlobalProgressBar=function(e,t,n){var r=byId("progressOuter"),i=r.childNodes[doh._runedSuite-1];i||(i=document.createElement("div"),r.appendChild(i),i.className="success",i.setAttribute("_target",n)),!t&&!i._failure&&(i._failure=!0,i.className="failure",n&&i.setAttribute("title","failed group "+n));var s=parseInt(e*1e4)/100;return i.style.width=s-doh._currentGlobalProgressBarWidth+"%",i._failure},doh._testFinished=function(e,t,n){var r=getFixtureNode(e,t),i=t.endTime-t.startTime;if(r){r.getElementsByTagName("td")[3].innerHTML=i+"ms",r.className=n?"success":"failure",r.getElementsByTagName("td")[2].setAttribute("_target",_loggedMsgLen);if(!n){_playSound("doh");var s=getGroupNode(e);s&&(s.className="failure",_getGroupToggler(e)(null,!0))}}if(doh._inGroup==e){var s=getGroupNode(e);doh._runed++;if(s&&doh._curTestCount){var o=doh._runed/doh._curTestCount,u=this._updateGlobalProgressBar((doh._runedSuite+o-1)/doh._groupCount,n,e),a=s.getElementsByTagName("td")[2].lastChild;a.className=u?"failure":"success",a.style.width=parseInt(o*100)+"%",s.getElementsByTagName("td")[3].innerHTML=parseInt(o*1e4)/100+"%"}}this._groupTotalTime+=i,this.debug(n?"PASSED":"FAILED","test:",t.name,i,"ms")},doh.registerUrl=function(e,t,n){var r=new String(e);this.register(e,{name:t,setUp:function(){doh.currentGroupName=r,doh.currentGroup=this,doh.currentUrl=t,this.d=new doh.Deferred,doh.currentTestDeferred=this.d,doh.showTestPage(),byId("testBody").src=t},timeout:n||1e4,runTest:function(){return this.d},tearDown:function(){doh.currentGroupName=null,doh.currentGroup=null,doh.currentTestDeferred=null,doh.currentUrl=null,doh.showLogPage()}})};var tabzidx=1,_showTab=function(toShow,toHide){var i;for(i=0;i<toHide.length;i++){var node=byId(toHide[i]);node&&(node.style.display="none")}toShow=byId(toShow);if(toShow)with(toShow.style)display="",zIndex=++tabzidx};doh.showTestPage=function(){_showTab("testBody",["logBody","perfTestsBody"])},doh.showLogPage=function(){_showTab("logBody",["testBody","perfTestsBody"])},doh.showPerfTestsPage=function(){_showTab("perfTestsBody",["testBody","logBody"])};var runAll=!0;doh.toggleRunAll=function(){runAll=!runAll;if(!byId("testList"))return;var e=byId("testList").tBodies[0],t=e.getElementsByTagName("input"),n=0,r;while(r=t[n++])r.checked=runAll,doh._groups[r.group].skip=!runAll};var listHeightTimer=null,setListHeight=function(){listHeightTimer&&clearTimeout(listHeightTimer);var e=byId("testList");if(!e)return;listHeightTimer=doh.setTimeout(function(){e.style.display="none",e.style.display=""},10)};_addOnEvt("resize",setListHeight),_addOnEvt("load",setListHeight),_addOnEvt("load",function(){if(loaded)return;loaded=!0,groupTemplate=byId("groupTemplate");if(!groupTemplate)return;groupTemplate.parentNode.removeChild(groupTemplate),groupTemplate.style.display="",testTemplate=byId("testTemplate"),testTemplate.parentNode.removeChild(testTemplate),testTemplate.style.display="",doh._updateTestList()}),_addOnEvt("load",function(){var e=doh._onEnd;doh._onEnd=function(){e.apply(doh,arguments),doh._failureCount==0?(doh.debug("WOOHOO!!"),_playSound("woohoo")):console.debug("doh._failureCount:",doh._failureCount),byId("play")&&n()};if(!byId("play"))return;var t=!1,n=function(){t?(byId("play").style.display=byId("pausedMsg").style.display="",byId("playingMsg").style.display=byId("pause").style.display="none",t=!1):(byId("play").style.display=byId("pausedMsg").style.display="none",byId("playingMsg").style.display=byId("pause").style.display="",t=!0)};doh.run=function(e){return function(){return doh._currentGroup||n(),e.apply(doh,arguments)}}(doh.run);var r=byId("toggleButtons").getElementsByTagName("span"),i,s=0;while(i=r[s++])i.onclick=n;doh._dojoPlotPerfResults=function(e,t,n){var r=doh.median(n),i=[],s;for(s=0;s<n.length;s++)i.push(r);var o={label:"name",items:[{name:t,trials:n},{name:"Median",trials:i}]},u=new dojo.data.ItemFileReadStore({data:o}),a=Math.floor(doh.min(n)),f=Math.ceil(doh.max(n)),l=(f-a)/10;a>0&&(a-=l,a<0&&(a=0),a=Math.floor(a)),f>0&&(f+=l,f=Math.ceil(f)),l=(f-a)/10;var c=new dojox.charting.DataChart(e,{type:dojox.charting.plot2d.Lines,displayRange:n.length,xaxis:{min:1,max:n.length,majorTickStep:Math.ceil((n.length-1)/10),htmlLabels:!1},yaxis:{min:a,max:f,majorTickStep:l,vertical:!0,htmlLabels:!1}});c.setStore(u,{name:"*"},"trials")},doh._asciiPlotPerfResults=function(){}})}else{_doh=window.parent.doh;var _thisGroup=_doh.currentGroupName,_thisUrl=_doh.currentUrl;if(_thisGroup){doh._testRegistered=function(e,t){_doh._updateTestList(_thisGroup,t)},doh._onEnd=function(){_doh._errorCount+=doh._errorCount,_doh._failureCount+=doh._failureCount,_doh._testCount+=doh._testCount,_doh.currentTestDeferred.callback(!0)};var otr=doh._getTestObj;doh._getTestObj=function(){var e=otr.apply(doh,arguments);return e.name=_thisUrl+"::"+arguments[0]+"::"+e.name,e},doh.debug=doh.hitch(_doh,"debug"),doh.registerUrl=doh.hitch(_doh,"registerUrl"),doh._testStarted=function(e,t){_doh._testStarted(_thisGroup,t)},doh._testFinished=function(e,t,n){_doh._testFinished(_thisGroup,t,n);if(doh.perfTestResults)try{gName=e.toString();var r=t.name;while(r.indexOf("::")>=0)r=r.substring(r.indexOf("::")+2,r.length);_doh.perfTestResults||(_doh.perfTestResults={}),_doh.perfTestResults[gName]||(_doh.perfTestResults[gName]={}),_doh.perfTestResults[gName][t.name]=doh.perfTestResults[gName][r]}catch(i){doh.debug(i)}},doh._groupStarted=function(e){this._setParent||(_doh._curTestCount=this._testCount,_doh._curGroupCount=this._groupCount,this._setParent=!0)},doh._report=function(){}}}}();